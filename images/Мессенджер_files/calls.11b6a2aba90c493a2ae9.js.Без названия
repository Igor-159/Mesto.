!function(e){function t(t){for(var a,i,l=t[0],c=t[1],s=t[2],p=0,d=[];p<l.length;p++)i=l[p],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(u&&u(t);d.length;)d.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,l=1;l<n.length;l++){var c=n[l];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={"web/calls":0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var u=c;o.push([145,"common","palette","592c10d08166dc3d8cd475e5f81247ea","vendors","98128115ad232d3b37413c0ed0fd40c7","7ed9e4d544bccc8a5ada0a712a9cf1ad","1fe1df46cdb12c3eb98af3fc95e7c624"]),n()}({145:function(e,t,n){e.exports=n("7ylw")},"1nu5":function(e,t,n){"use strict";n.r(t),n.d(t,"VkIndexer",(function(){return a}));var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),r=a.length;r--;){var o=a[r],i="";if(o){for(var l=0;l<6;l++){var c=o.charCodeAt(l);if(c){var s=this.toTranslit[c],u=o.substr(l,1);i+=null!=s?s:u}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},o=n[a],i="",l="",c="",s=o.length>1;if(o){for(var u=0;u<6;u++){var p=o.charCodeAt(u);if(p){var d=this.toTranslit[p],f=o.substr(u,1);if(i+=null!=d?d:f,s){var m=this.toLocalCase[f],h=this.toLocalTranslit[p];l+=null!=m?m:f,c+=null!=h?h:f}}}r[i]=1,s&&(r[l]=2,r[c]=3),t.push(r)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,o=0;o<6;o++){var i=a.substr(o,1)||-1;if(!r[i])break;r=r[i]}if(r.length)for(var o in r)if(this.equals(r[o],e)){r.splice(o,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(r(e[0])||r(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var o in n)if(n.hasOwnProperty(o)){if(r&&!a)break;var i=this.localSearch(n[o],0,t);i.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,i):i,r=!0}for(var l=a[0],c=a.length+1,s=[],u=1;u<c;u++){var p=a[u];p!=l&&(s.push(l),l=p)}return s},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)e.hasOwnProperty(r)&&(a[i=r.substr(t,1)||-1]||(a[i]={}),a[i][r]=1);if(6==t++)return n;var o=[];for(var i in a)if("-1"===i)for(var l in n)n.hasOwnProperty(l)&&o.push.apply(o,this.localSearch(a[i],t,n[l]));else{var c=this.localSearch(a[i],t,n[i]);o.push.apply(o,c)}return o},e}();function r(e){return!isNaN(e)}},"6Rqf":function(e,t,n){"use strict";function a(e,t){var n=r(t),a=e.includes("?");return e+(a?"&":"?")+n}function r(e){return Object.keys(e).map((function(t){var n=e[t];return(t=encodeURIComponent(t||""))+"="+encodeURIComponent(n||"")})).join("&")}function o(e){return e.split("&").reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1],e}),{})}function i(e,t){var n=r(t);return fetch(e,{method:"POST",body:n,mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()}))}n.r(t),n.d(t,"corsRequest",(function(){return i})),n.d(t,"makeParams",(function(){return r})),n.d(t,"makeUrl",(function(){return a})),n.d(t,"parseParams",(function(){return o}))},"7ylw":function(e,t,n){"use strict";n.r(t);n("91GP"),n("VRzm"),n("Btvt");var a,r=n("q1tI"),o=n.n(r),i=n("i8i4"),l=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("/MKj")),c=n("83Q7"),s=n("ZxpX"),u=function(){return(u=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},p=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear"}(a||(a={}));var d=function(e){var t=e.icon,n=e.text,a=e.type,r=e.className,i=p(e,["icon","text","type","className"]),l=Object(s.classNames)("CallButton","CallButton--"+a,r,{"CallButton--withText":!!n}),c=u(u({},i),{onMouseDown:function(e){e.preventDefault(),i.onMouseDown&&i.onMouseDown(e)}});return o.a.createElement("button",u({className:l},c),o.a.createElement("figure",{className:"CallButton__icon"},t),n)},f=function(){return(f=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},m=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},h=function(e){var t=m(e,[]);return o.a.createElement("svg",f({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"}))},v=function(){return(v=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},E=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},_=function(e){var t=E(e,[]);return o.a.createElement("svg",v({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"}))},g=function(){return(g=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},O=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},b=function(e){var t=O(e,[]);return o.a.createElement("svg",g({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"}))},C=n("17x9"),y=n.n(C);function S(e){var t=e.id,n=e.disablePhoto,a=e.photo,o=e.className,i=e.children,l=t%6+1,c=Object(s.classNames)("BlurredBackground",o,"BlurredBackground--"+l,{"BlurredBackground--noPhoto":!n&&!a});return r.createElement("div",{className:c},r.createElement("div",{className:"BlurredBackground__in"},!n&&a&&r.createElement("div",{className:"BlurredBackground__inner",style:{backgroundImage:`url(${a})`}})),r.createElement("div",{className:"BlurredBackground__content"},i))}S.defaultProps={photo:"",children:"",disablePhoto:!1};var I=n("756/"),A=function(e){var t=e.id,n=e.waves,a=void 0!==n&&n,r=e.size,i=void 0===r?"m":r,l=e.photo,c=void 0===l?"":l,u=e.alt,p=e.letter,d=Object(s.classNames)("CallPhoto","CallPhoto--"+i,{"CallPhoto--waves":!!a});return c?o.a.createElement("img",{src:c,className:d,alt:u}):o.a.createElement(I.ConversationNoPhoto,{id:t,text:p||u.slice(0,1),size:i,className:d})},N=n("2zsc");function w(e){var t=e.title,n=e.description,a=e.className;return r.createElement("header",{className:Object(s.classNames)("CallHeader",a)},r.createElement("h1",{className:"CallHeader__title"},r.createElement(N.default,null,t)),r.createElement("div",{className:"CallHeader__description"},n))}var P=function(){return(P=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},L=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},T=Object(r.forwardRef)((function(e,t){var n,a=e.type,r=e.isActive,i=e.icon,l=e.className,c=L(e,["type","isActive","icon","className"]),u=Object(s.classNames)("CallIconButton",l,((n={"CallIconButton--active":r})["CallIconButton--"+a]=!!a,n)),p=P(P({},c),{onMouseDown:function(e){e.preventDefault(),c.onMouseDown&&c.onMouseDown(e)}});return o.a.createElement("button",P({},p,{className:u,ref:t}),i)})),j=n("dt/K"),D=o.a.createContext({getLang:function(e){return e},langSex:function(e){return e},langNumeric:function(e){return""+e}});function M(e){var t=e.id,n=e.photo,a=e.title,o=e.description,i=e.onCollapseCall,l=e.children,c=r.useContext(D).getLang;return r.createElement("section",{className:"IncomingCall"},r.createElement(S,{id:t,photo:n}),r.createElement(j.default,{position:"b",text:c("calls_collapse"),marginTop:-6},r.createElement(T,{type:"collapse",className:"IncomingCall__collapse",onClick:i})),r.createElement(w,{title:a,description:o}),r.createElement(A,{id:t,waves:!0,photo:n,alt:a||""}),r.createElement("footer",{className:"IncomingCall__footer"},l))}var R=n("r7nW"),k=n("1nu5"),x=function(e,t,n){var a=Object(r.useRef)(null);a.current=a.current?a.current:new k.VkIndexer(e,t);var o=a.current,i=Object(r.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),l=Object(r.useState)(e),c=l[0],s=l[1],u=Object(r.useState)(i(e)),p=u[0],d=u[1];return Object(r.useEffect)((function(){var t=i(e),a=e.filter((function(e){return!p[n(e)]})),r=c.filter((function(e){return!t[n(e)]}));(a.length||r.length)&&(a.forEach((function(e){o.add(e)})),r.forEach((function(e){o.remove(e)})),s(e),d(t))}),[e]),o};var U=function(e){var t=e.onClose,n=e.onBackdropClick,a=e.isIncoming,i=void 0!==a&&a,s=e.isCautionBoxShown,u=void 0!==s&&s,p=e.children,d=Object(l.useDispatch)();Object(r.useEffect)((function(){return window.bodyNode.classList.add("layers_shown"),function(){window.bodyNode.classList.remove("layers_shown")}}),[]);var f=u?function(){d({type:c.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:i||!1})}:t;return o.a.createElement(R.default,{className:"CallModal",disableBodyScroll:!0,onClose:f,onBackdropClick:n},p)},G=n("rudk"),V=function(e){return 0===e||Object(G.isChatPeer)(e)};function H(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var a=e.browser.hasMicrophonePermission(),r=e.browser.hasCameraPermission(),o=n&&!a,i=t&&!r;return o||i?function(e,t,n){return e.browser.getUserMedia(t,n).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))}(e,i,o):Promise.resolve()}var B=function(){return(B=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},F=new(function(){function e(){}return e.prototype.setActionStatCollector=function(e){this.actionStatCollector=e},e.prototype.logEvent=function(e){var t,n=B(B({},e),{peer_id:e.peer_id.toString(),session_id:e.session_id||"",lib_version:"calls_v2"});this.actionStatCollector&&this.actionStatCollector.logEvent(((t={type:"type_voip_call_item"}).type_voip_call_item=n,t))},e}());function z(e,t,n){void 0===t&&(t=!0);var a="";return e&&t?a=n("calls_error_no_cam_and_mic"):e?a=n("calls_error_no_cam"):t&&(a=n("calls_error_no_mic")),a}function W(e,t){var n;return((n={})[c.MediaError.CAMERA_PERMISSION]=t("calls_error_no_cam"),n[c.MediaError.MIC_PERMISSION]=t("calls_error_no_mic"),n[c.MediaError.CAMERA_ACCESS]=t("calls_error_cameralock"),n[c.MediaError.MIC_ACCESS]=t("calls_error_miclock"),n[c.MediaError.MIC_NOT_FOUND]=t("calls_error_nomic"),n[c.MediaError.SCREEN_PERMISSION]=t("calls_error_screenpermission"),n[c.MediaError.SCREEN_ACCESS]=t("calls_error_screenlock"),n)[e]}function Y(e){var t=e.SDK,n=Object(l.useSelector)((function(e){return[e.peer,e.callData,e.participants]})),r=n[0],i=n[1],s=n[2],u=Object(l.useDispatch)(),p=o.a.useContext(D).getLang,f=V(r)?i.conversation:s[r],m=i.type===c.CallType.VIDEO,v=p(m?"calls_incoming_videocall":"calls_incoming_audiocall"),E=p(m?"calls_reply_with_audio":"calls_reply"),g=p(m?"calls_reject_call":"calls_reject"),O=function(e,n){return H(t,e,n).then((function(){return t.acceptCall(e,n)})).then((function(t){var n=t.acceptTime;u({type:c.CHANGE_MODE,mode:c.Mode.CALL,ts:n}),F.logEvent({call_event_type:c.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:i.callId,peer_id:r,is_group_call:V(r),reason:e?c.CallType.VIDEO:c.CallType.AUDIO})})).catch((function(t){u({type:c.ERROR,text:z(e,!0,p),handleType:c.ErrorHandleType.DECLINE}),console.error(t)}))};return o.a.createElement(U,{onClose:t.declineCall,isIncoming:!0,isCautionBoxShown:!0},o.a.createElement(M,{id:r,title:(null==f?void 0:f.tab)||"",description:v,photo:(null==f?void 0:f.photo)||"",onCollapseCall:function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED})}},m&&o.a.createElement(d,{text:p("calls_reply_with_video"),type:a.POSITIVE,icon:o.a.createElement(h,null),onClick:function(){return O(!0,!0)}}),o.a.createElement(d,{text:E,type:m?a.REGULAR:a.POSITIVE,icon:o.a.createElement(_,null),onClick:function(){return O(!1,!0)}}),o.a.createElement(d,{text:g,type:a.NEGATIVE,icon:o.a.createElement(b,null),onClick:function(){t.declineCall(),F.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:i.callId,peer_id:r,is_group_call:V(r),reason:"none"})}})))}n("pIFo"),n("SRfc"),n("hhXQ"),n("KKXr");var K=n("DM26"),J=n("Iqrf"),q=n("gdug"),X=n("1BRX"),$=n("nAFc");function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ee(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function te(e){var t=e.shortName,n=e.firstName;if(!t||!n){var a=Z(e.name.split(" "),2),r=a[0],o=a[1];t=`${r} ${o?o.length>2?o.substring(0,1)+".":o:""}`,n=r}return Q({},e,{peerId:+e.id,tab:e.name,shortName:t,firstName:n})}function ne(e){var t=Z(e,2),n=t[0],a=t[1];return["peerId"in n?n:te(n),a?a.map(te):[]]}function ae(e){var t=Z(e,2),n=t[0],a=t[1];return[Q({},n,{tab:n.name}),Object(G.isUserPeer)(n.peerId)?[n]:a]}function re(e){var t=e.caller_info,n=e.chat_info;return n?2e9+n.chat_id:t.user_id}function oe(e){return!!e.payload.chat_info}function ie(e){return Object.values(e.participants).filter(t=>t.peerId===e.me||t.status)}function le(e){return!!Object.values(e.participants).find(t=>(t.peerId===e.me||t.wasConnected)&&t.mediaSettings&&t.mediaSettings.isVideoEnabled)}function ce(e){var t=Date.now(),n=Math.max(0,Math.floor((t-e)/1e3));return n<=599?"0"+Object(X.formatTime)(n):Object(X.formatTime)(n)}function se(e){q.browser.safari&&+q.browser.version.split(".")[0]<13&&window.setTimeout(()=>{e&&e.current&&(e.current.volume=1e-4)},10)}var ue=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return function(){return n.reduce((e,t)=>t(e),e)(...arguments)}},pe=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{attempts:10,timeout:0};return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return n.attempts>0?Object(K.pause)(n.timeout).then(()=>t(...r)).catch(()=>(!n.timeout&&(n.timeout=1),n.attempts--,n.timeout=Math.min(2*n.timeout,300),e(t,n)(...r))):Promise.reject()}},de=(e,t)=>function(){for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t(...a).catch(n=>{if(n.error===c.FatalError.AUTH)return e().then(()=>t(...a));throw n})},fe=(e,t,n)=>function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];var i=window.Calls.id<0&&{anonymId:window.Calls.id};return n(e(),...r).catch(e=>e&&e.match&&e.match(/1001;/)?Object(J.getWriteHash)(i).then(e=>{var n=Z(e,1)[0];return t(n)}).then(e=>n(e,...r)):Promise.reject(e))};function me(e,t,n,a,r){var o=e=>Object($.decodeHTMLEntities)(n(e));if(e.length>t.length){var i=e.length-t.length,l=e.slice(0,3).map(o).join(", ");return r(i,a("calls_members_list_label",i)).replace("{name}",l)}if(t.length>1){var c=t.length>2?e.slice(0,2).map(o).join(", "):o(e[0]),s=o(e[t.length-1]);return a("global_and").replace("{before}",c).replace("{after}",s)}return 1===t.length?o(e[0]):""}function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ve(e){var t=e.hasVideo,n=e.stream,a=e.isMe,o=e.isVideoVisible,i=e.isScreenShareStream,l=e.setVideoVisibility,c=e.className,u=e.allowContain,p=r.useRef(null),d=t&&n,f={autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata",onLoadedData:()=>d&&!o&&l&&l(!0)},m=u&&function(e,t){if(t&&t.active){var n=t.getVideoTracks();if(!n||0===n.length)return!1;var a=n[0].getSettings(),r=void 0!==a.width?a.width:e?e.videoWidth:0;return(void 0!==a.height?a.height:e?e.videoHeight:0)>=r}return!1}(p.current,n)||i,h=Object(s.classNames)("Video",c,{"Video--contain":d&&n&&m,"Video--visible":d&&o,"Video--mirrored":a&&d&&!i});return r.useEffect(()=>{d&&p.current&&(p.current.srcObject=n,p.current.volume=0,se(p)),!d&&o&&l&&l(!1)},[e.hasVideo,e.stream,o]),d?r.createElement("video",he({className:h,ref:p},f)):null}ve.defaultProps={hasVideo:!1,isMe:!1,isVideoVisible:!1,allowContain:!0,isScreenShareStream:!1};var Ee=n("FEsp");function _e(e){var t=e.isInverted,n=Object(s.classNames)("CallingStatus",{"CallingStatus--inverted":!!t});return o.a.createElement("div",{className:n},o.a.createElement("span",{className:"CallingStatus__part"}),o.a.createElement("span",{className:"CallingStatus__part"}),o.a.createElement("span",{className:"CallingStatus__part"}))}var ge,Oe=function(e){var t=e.id,n=e.photo,a=e.photoSize,r=void 0===a?"m":a,i=e.status,l=e.wasConnected,u=e.alt,p=e.letter,d=e.className;return o.a.createElement(Ee.default,{className:Object(s.classNames)("ParticipantCard",d)},o.a.createElement("span",{className:"ParticipantCard__in"},o.a.createElement(A,{id:t,photo:n,size:r,alt:u||"",letter:p}),i!==c.CallStatus.CONNECTED&&!l&&o.a.createElement("div",{className:"ParticipantCard__status"},o.a.createElement(_e,{isInverted:!0}))))},be=function(){return(be=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ce=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ye=function(e){var t=Ce(e,[]);return o.a.createElement("svg",be({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},t),o.a.createElement("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"}))},Se=function(){return(Se=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ie=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ae=function(e){var t=Ie(e,[]);return o.a.createElement("svg",Se({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"}))},Ne=n("N+uU"),we=function(){return(we=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Pe=function(e){var t=e.children,n=e.items,a=Object(r.useState)(!1),i=a[0],l=a[1],c=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l(!i)}),[i]),s=function(e){e.target&&e.target.closest(".CallsDropdown")||l(!1)};return Object(r.useEffect)((function(){return document.documentElement.addEventListener("click",s),function(){return document.documentElement.removeEventListener("click",s)}}),[]),i?o.a.createElement(Ne.Popper,{content:o.a.createElement("ul",{className:"CallsDropdown"},n.map((function(e,t){return o.a.createElement("li",{className:"CallsDropdown__item",key:e.key||t},"href"in e&&o.a.createElement("a",{href:e.href,target:"_blank",onClick:function(){return l(!1)},className:"CallsDropdown__button"},e.text),"onClick"in e&&o.a.createElement("button",{onClick:function(){e.onClick(),l(!1)},className:"CallsDropdown__button"},e.text))}))),mode:"point"},o.a.cloneElement(t,we(we({},t.props),{onClick:c,"data-active":i}))):o.a.cloneElement(t,we(we({},t.props),{onClick:c}))},Le=function(e){var t=e.id,n=e.isOrator,a=void 0!==n&&n,i=e.isInfoShown,l=e.isPinned,u=e.isHandRaised,p=e.photo,d=e.hasVideo,f=e.hasAudio,m=e.isSharingScreen,h=e.isSpeaking,v=void 0!==h&&h,E=e.stream,_=e.isMe,g=void 0!==_&&_,O=e.photoSize,b=e.name,C=e.letter,y=e.status,I=void 0===y?c.CallStatus.CONNECTED:y,A=e.wasConnected,w=void 0===A||A,P=e.onClickParticipant,L=e.onDblClickParticipant,T=e.onShow,j=e.onHide,M=e.allowContain,R=void 0!==M&&M,k=e.actions,x=o.a.useContext(D).getLang,U=o.a.useRef(null),G=!!P||!!L,V=Object(s.classNames)("Participant",{"Participant--isInteractive":G,"Participant--isPinned":l,"Participant--isSpeaking":v,"Participant--isOrator":a}),H=o.a.useState(!1),B=H[0],F=H[1];o.a.useEffect((function(){if(T&&j){T(t);var e=new IntersectionObserver((function(e){e[0].isIntersecting?T(t):j(t)}),{root:null,rootMargin:"0px",threshold:0});return U.current&&e.observe(U.current),function(){return e.disconnect()}}}),[U]),o.a.useEffect((function(){d&&E||F(!1)}),[d,E,B]);var z=!(d&&E)||!B,W=Object(r.useCallback)((function(e){P&&P(e,t)}),[P]),Y=Object(r.useCallback)((function(e){L&&L(e,t)}),[L]);return o.a.createElement("article",{ref:U,className:V,onClick:W,onDoubleClick:Y},k&&k.length>0&&o.a.createElement(Pe,{items:k},o.a.createElement("button",{className:"Participant__more","aria-label":x("global_actions")},o.a.createElement(Ae,null))),G&&o.a.createElement("header",{className:"Participant__header"},l&&o.a.createElement("div",{className:"Participant__pin"})),z&&o.a.createElement(S,{id:t,photo:p,className:"Participant__main"},o.a.createElement(Oe,{id:t,photo:p,photoSize:O,status:I,wasConnected:w||g,alt:b||"",letter:C,className:i?"Participant__offsetCard":""})),u&&o.a.createElement("div",{className:"Participant__handIndicator"},o.a.createElement(ye,{className:"Participant__handIcon"})),d&&o.a.createElement(ve,{className:"Participant__main",hasVideo:d,stream:E,isMe:g,isVideoVisible:B,isScreenShareStream:m,setVideoVisibility:F,allowContain:R}),i&&o.a.createElement("footer",{className:"Participant__footer"},o.a.createElement(N.default,{className:"Participant__name"},b),(w||g)&&!f&&o.a.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--mic"})))},Te=function(e){var t=e.id,n=e.name,a=e.letter,r=e.hasAudio,i=e.hasVideo,l=e.isSharingScreen,c=e.stream,u=e.wasConnected,p=e.opponentId,d=e.opponentHasAudio,f=e.opponentHasVideo,m=e.opponentIsSharingScreen,h=e.opponentStream,v=e.opponentPhoto,E=e.opponentName,_=e.opponentLetter,g=e.opponentWasConnected,O=Object(s.classNames)("OneToOne",{"OneToOne--hasVideo":i,"OneToOne--opponentHasVideo":f});return o.a.createElement("div",{className:O},o.a.createElement("aside",{className:"OneToOne__local"},o.a.createElement(Le,{id:t,hasVideo:i,hasAudio:r,isSharingScreen:l,stream:c,isMe:!0,name:n,letter:a,photoSize:"m",wasConnected:u})),o.a.createElement("main",{className:"OneToOne__remote"},o.a.createElement(Le,{id:p,hasVideo:f,hasAudio:d,isSharingScreen:m,stream:h,photo:v,name:E,letter:_,photoSize:"l",wasConnected:g})))},je=function(){return(je=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},De=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Me=function(e){var t=e.children,n=e.className,a=e.alignX,r=e.alignY,i=e.size,l=void 0===i?"m":i,c=De(e,["children","className","alignX","alignY","size"]),u=Object(s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+a,"CallIconButtonGroup--"+r,"CallIconButtonGroup--size-"+l,n);return o.a.createElement("div",je({className:u},c),t)},Re=function(){return(Re=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ke=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},xe=function(e){var t=ke(e,[]);return o.a.createElement("svg",Re({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"}))},Ue=function(){return(Ue=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ge=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ve=Object(r.forwardRef)((function(e,t){var n=e.unreadCount,a=void 0===n?0:n,r=Ge(e,["unreadCount"]),i="",l="";switch(!0){case!a:i="none";break;case a<=9:i="single",l=a.toString();break;case a<=99:i="double",l=a.toString();break;case a>99:i="max",l="99+"}var c=Object(s.classNames)("ChatIconButton","ChatIconButton--"+i);return o.a.createElement("button",Ue({className:c},r,{ref:t}),l&&o.a.createElement("div",{className:"ChatIconButton__count "},l))})),He=function(){return(He=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Be=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Fe=function(e){var t=Be(e,[]);return o.a.createElement("svg",He({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"}))},ze=function(){return(ze=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},We=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ye=function(e){var t=We(e,[]);return o.a.createElement("svg",ze({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"}),o.a.createElement("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"}))},Ke=function(){return(Ke=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Je=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},qe=function(e){var t=Je(e,[]);return o.a.createElement("svg",Ke({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"}))},Xe=n("UlUB"),$e=function(){return($e=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Qe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ze=function(e){var t=Qe(e,[]);return o.a.createElement("svg",$e({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M3.86 14c-.24 0-.47.02-.7.06a1 1 0 11-.33-1.98 6.14 6.14 0 017.08 7.08 1 1 0 01-1.97-.33A4.14 4.14 0 003.85 14z"}),o.a.createElement("path",{d:"M4 20a2 2 0 100-4 2 2 0 000 4zM10.96 4h2.08c1.37 0 2.45 0 3.33.07.9.07 1.65.23 2.35.58a6 6 0 012.63 2.63c.35.7.5 1.46.58 2.35.07.88.07 1.33.07 1.33v2.08s0 .45-.07 1.33c-.07.9-.23 1.65-.58 2.35a6 6 0 01-2.63 2.63c-.7.35-1.46.5-2.35.58-.88.07-1.96.07-3.33.07H13a1 1 0 110-2c1.42 0 2.42 0 3.2-.06a4.23 4.23 0 001.62-.38 4 4 0 001.74-1.74c.2-.37.31-.85.38-1.62.06-.78.06-1.2.06-1.2v-2s0-.42-.06-1.2a4.23 4.23 0 00-.38-1.62 4 4 0 00-1.74-1.74c-.37-.2-.85-.31-1.62-.38C15.42 6 14.42 6 13 6h-2c-1.42 0-2.42 0-3.2.06-1.78.15-3.35 1.23-3.66 3.1a1 1 0 11-1.97-.32 5.8 5.8 0 013.1-4.19c.7-.35 1.47-.5 2.36-.58C8.51 4 9.6 4 10.96 4z"}))},et=function(){return(et=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},tt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},nt=function(e){var t=tt(e,[]);return o.a.createElement("svg",et({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"}))},at=function(){return(at=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},rt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ot=function(e){var t=rt(e,[]);return o.a.createElement("svg",at({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"}))},it=function(){return(it=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},lt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ct=function(e){var t=lt(e,[]);return o.a.createElement("svg",it({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"}))},st=function(){return(st=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ut=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},pt=function(e){var t=ut(e,[]);return o.a.createElement("svg",st({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"}))},dt=function(){return(dt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ft=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function mt(e){var t=e.children,n=e.content,a=e.position,i=void 0===a?"auto":a,l=e.align,c=void 0===l?"auto":l,u=e.appearance,p=void 0===u?"dark":u,d=e.open,f=void 0!==d&&d,m=e.onOpen,h=e.onClose,v=e.delay,E=void 0===v?50:v,_=ft(e,["children","content","position","align","appearance","open","onOpen","onClose","delay"]),g=Object(r.useState)(f?ge.OPENED:ge.CLOSED),O=g[0],b=g[1],C=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=null,t=null,n=function(){e&&(clearTimeout(e),e=null)},a=function(){n(),e=window.setTimeout((function(){b(ge.OPENED),m&&m()}),E)},r=function(){n(),t=window.setTimeout((function(){O===ge.OPENED?b(ge.IS_CLOSING):(b(ge.CLOSED),h&&h())}),0)};return C&&C.current&&(C.current.addEventListener("mouseenter",a),C.current.addEventListener("mouseleave",r)),function(){C&&C.current&&(C.current.removeEventListener("mouseenter",a),C.current.removeEventListener("mouseleave",r)),n(),t&&(window.clearTimeout(t),t=null)}}),[C,O]),Object(r.useEffect)((function(){var e=f?ge.OPENED:ge.CLOSED;O!==e&&b(e)}),[f]);var y=Object(r.useCallback)((function(){O===ge.IS_CLOSING&&(b(ge.CLOSED),h&&h())}),[O]),S=Object(s.classNames)("TooltipNew",{"TooltipNew--removed":"isClosing"===O,"TooltipNew--dark":"dark"===p,"TooltipNew--light":"light"===p}),I=o.a.createElement("div",{className:S,onTransitionEnd:y},n);return o.a.createElement(Ne.Popper,dt({content:I,position:i,align:c,open:O!==ge.CLOSED,ref:C},_),t)}!function(e){e.OPENED="opened",e.IS_CLOSING="isClosing",e.CLOSED="closed"}(ge||(ge={}));var ht=function(){return o.a.createElement("svg",{height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},o.a.createElement("mask",{id:"MicIconWithSpeakingIndicatorMask"},o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"})),o.a.createElement("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"}),o.a.createElement("g",{mask:"url(#MicIconWithSpeakingIndicatorMask)"},o.a.createElement("g",{className:"MicIconWithSpeakingIndicator__scale"},o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"}),o.a.createElement("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"}))))};function vt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Et(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _t(e){var t=e.id,n=e.photo,o=e.disablePhoto,i=e.info,l=e.chatUnreadCount,c=void 0===l?0:l,u=e.callMenuActions,p=e.isVideoEnabled,f=e.isAudioEnabled,m=e.isScreenSharingEnabled,v=e.isOratorMode,E=e.isFullScreen,_=e.onToggleVideo,g=e.onToggleAudio,O=e.onLeaveCall,b=e.onCollapseCall,C=e.onToggleOratorMode,y=e.onChat,I=e.onHandClick,A=e.onToggleScreenShare,N=e.onFullScreenToggle,w=e.isParticipantControlActive,P=e.isLayoutSwitchShown,L=e.isScreenShareControlShown,j=e.isHandRaised,M=e.isHandControlShown,R=e.isChatControlShown,k=e.onParticipantsClick,x=e.onTooltipChange,U=e.onHidePanel,G=e.notification,V=e.tooltips,H=e.amISpeaking,B=e.children,F=r.useContext(D).getLang,z=Object(s.classNames)("Call",{"Call--fullscreen":E}),W=r.useRef(null),Y=function(e,t){var n=vt(r.useState(!0),2),a=n[0],o=n[1],i=r.useRef(null),l=r.useRef(!1),c=r.useRef(!1),s=()=>{l.current||c.current?c.current=!1:(i.current&&window.clearTimeout(i.current),o(!0),i.current=window.setTimeout(()=>{o(!1),i.current=null,t&&t()},5e3))};return r.useEffect(()=>{s();var t=Object(Xe.throttle)(()=>{s()},1e3);return e.current.addEventListener("mousemove",t),()=>{l.current=!0,i.current&&window.clearTimeout(i.current),e.current.removeEventListener("mousemove",t)}},[]),[a,e=>{e?o(!0):(o(!1),c.current=!0)}]}(W,U),K=vt(Y,2),J=K[0],q=K[1],X=Object(s.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!J}),$=Object(s.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!J},"Call__curtain"),Q=Object(s.classNames)("Call__buttons","Call__controlPanel",{"Call__controlPanel--hideBottom":!J});return r.createElement("section",{className:z,onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),ref:W},i,r.createElement("div",{className:"Call__content"},r.createElement(S,{id:t,photo:n,disablePhoto:o},B)),r.createElement("div",{className:$}),r.createElement(Me,{alignX:"l",alignY:"b",className:X},R&&r.createElement(mt,{content:F("calls_chat"),open:V.chat,delay:300,onOpen:()=>x("chat",!0),onClose:()=>x("chat",!1)},r.createElement(Ve,{unreadCount:c,onClick:y})),M&&r.createElement(mt,{content:F(j?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:V.hand,delay:300,onOpen:()=>x("hand",!0),onClose:()=>x("hand",!1)},r.createElement(T,{icon:r.createElement(nt,null),type:"hand",isActive:j,onClick:I})),L&&r.createElement(mt,{content:F(m?"calls_stop_screen_share":"calls_start_screen_share"),open:V.screenShare,delay:300,onOpen:()=>x("screenShare",!0),onClose:()=>x("screenShare",!1)},r.createElement(T,{icon:r.createElement(Ze,null),isActive:m,onClick:A}))),r.createElement(Me,{alignX:"r",alignY:"b",style:E?{right:"70px"}:void 0,className:X},P&&r.createElement(mt,{content:F(v?"calls_show_grid":"calls_show_orator"),open:V.layout,delay:300,onOpen:()=>x("layout",!0),onClose:()=>x("layout",!1)},r.createElement(T,{type:v?"changeToGrid":"changeToOrator",onClick:C})),r.createElement(Pe,{items:u},r.createElement(T,{type:"settings"})),r.createElement(mt,{content:F("calls_collapse"),open:V.collapse,delay:300,onOpen:()=>x("collapse",!0),onClose:()=>x("collapse",!1)},r.createElement(T,{type:"collapse",onClick:b})),r.createElement(mt,{content:F(E?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:V.fullscreen,delay:300,onOpen:()=>x("fullscreen",!0),onClose:()=>x("fullscreen",!1)},r.createElement(T,{onClick:N,icon:E?r.createElement(ot,null):r.createElement(ct,null)}))),r.createElement("footer",{className:"Call__footer"},G&&r.createElement("div",{className:"Call__notification"},G),r.createElement("div",{className:Q},r.createElement(d,{type:w?a.OFF:a.ON,icon:r.createElement(qe,null),onClick:k,className:"Call__footerButton"}),r.createElement(d,{type:p?a.ON:a.OFF,icon:p?r.createElement(h,null):r.createElement(pt,null),onClick:_,className:"Call__footerButton"}),r.createElement(d,{type:f?a.ON:a.OFF,icon:f?H?r.createElement(ht,null):r.createElement(Ye,null):r.createElement(Fe,null),onClick:g,className:"Call__footerButton"}),r.createElement(d,{type:a.NEGATIVE,icon:r.createElement(xe,null),onClick:O,className:"Call__footerButton"}))))}var gt=function(e){var t=e.limit,n=e.children,a=r.Children.toArray(n),i=Math.min(a.length,t),l=Object(s.classNames)("CallGridNew","CallGridNew--c"+i);return o.a.createElement("section",{className:l},o.a.createElement("div",{className:"CallGridNew__in"},a.map((function(e,t){return o.a.createElement("article",{className:"CallGridNew__item",key:e.key||t},e)}))))},Ot=function(e){var t=e.children,n=e.orator,a=e.onToggleParticipantsAside,r=e.isShownParticipantsAside,i=o.a.Children.toArray(t),l=Object(s.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!r}),c=Object(s.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!r}),u=Object(s.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":r,"CallOrator__toggleArrow--toRight":!r});return o.a.createElement("article",{className:l},o.a.createElement("main",{className:"CallOrator__orator"},n),o.a.createElement("button",{className:"CallOrator__toggleOthers",onClick:a},o.a.createElement("div",{className:"CallOrator__toggleIcon"},o.a.createElement("div",{className:u}))),o.a.createElement("aside",{className:c},o.a.createElement("ul",{className:"CallOrator__list"},i.map((function(e){return o.a.createElement("li",{className:"CallOrator__participant",key:"key"in e?e.key:void 0},e)})))))},bt=n("P13b");function Ct(e){return new Promise((t,n)=>{var a=new Image;a.src=e,a.onload=t,a.onerror=n})}function yt(e){var t=[].concat(...e).map(e=>{var t=e.photo;return t?Ct(t):Promise.resolve()});return Promise.all(t).then(()=>e).catch(()=>e)}function St(e){nav.go(Object(bt.getConvoLocation)(e))}var It=function(e){var t=e.children,n=e.className,a=Object(s.classNames)("CallNotification",n);return o.a.createElement("div",{className:a},t)},At=function(){return(At=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Nt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},wt=function(e){var t=Nt(e,[]);return o.a.createElement("svg",At({width:"14",height:"12",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),o.a.createElement("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"}))},Pt=function(){var e=Object(l.useSelector)((function(e){return e})),t=Object(l.useDispatch)(),n=o.a.useContext(D),a=n.getLang,i=n.langSex,s=Object(r.useMemo)((function(){return function(e,t,n){if(!e.notification)return null;switch(e.notification.type){case c.NotificationType.SPEAKING_ON_MUTE:return o.a.createElement(N.default,null,t("calls_notification_mic_is_mute"));case c.NotificationType.SCREEN_SHARING_STARTED:if(!(r=e.participants[e.notification.data])||!r.name)return o.a.createElement(N.default,null,t("calls_notification_screen_sharing_started"));var a=n(r.sex,t("calls_notification_user_started_screen_sharing",!0));return o.a.createElement(N.default,null,a.replace("{user}",r.name));case c.NotificationType.RAISED_HAND:var r=e.participants[e.notification.data];a=n(r.sex,t("calls_notification_raised_hand",!0));return o.a.createElement(N.default,null,a.replace("{user}",r.name));case c.NotificationType.BAD_NETWORK_CONNECTION:return o.a.createElement(N.default,null,t("calls_notification_bad_network_connection"));case c.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[o.a.createElement(wt,{key:"icon"}),o.a.createElement(N.default,{key:"text"},t("calls_notification_bad_network_connection_disable_camera"))];default:return null}}(e,a,i)}),[e.notification]),u=Object(r.useRef)(0);return Object(r.useEffect)((function(){return u.current&&window.clearTimeout(u.current),e.notification&&0!==e.notification.timer&&(u.current=window.setTimeout((function(){t({type:c.CALL_NOTIFICATION,notification:null}),u.current=0}),e.notification.timer||c.defaultNotificationLifeSpan)),function(){u.current&&window.clearTimeout(u.current)}}),[e.notification]),e.notification?o.a.createElement(It,null,s):null};var Lt=n("o4aG"),Tt=function(e){return e<0},jt=function(e){return(null==e?void 0:e.peerId)?e.isAnonym?{id:e.peerId.toString(),type:Lt.ExternalIdType.ANONYM}:e.peerId.toString():null},Dt=function(e,t,n,a,r,o){var i,l,s,u=a.peerId===e.me,p=Tt(a.peerId)||a.isAnonym,d=!!(null===(l=null===(i=e.callData)||void 0===i?void 0:i.permissions)||void 0===l?void 0:l.MUTE_PARTICIPANTS),f=V(e.peer),m=[];return u||!r||p||m.push({text:o("calls_go_to_profile"),onClick:function(){n({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED}),e.isManagementOpen&&n({type:c.MANAGEMENT,isOpen:!1}),window.nav.go(a.link)}}),u||p||Tt(e.me)||m.push({text:o("calls_go_to_chat_with_participant"),onClick:function(){n({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED}),n({type:c.MANAGEMENT,isOpen:!1}),St(a.peerId)}}),u||!f||Tt(e.me)||m.push({text:o("calls_participant_menu_kick"),onClick:function(){return t.removeParticipant(jt(a))}}),!u&&f&&(null===(s=a.mediaSettings)||void 0===s?void 0:s.isAudioEnabled)&&d&&!Tt(e.me)&&m.push({text:o("calls_participant_menu_mute"),onClick:function(){return t.muteParticipant(jt(a))}}),m},Mt=function(e,t){var n=e.participants[t];return n&&(n.peerId===e.me||!!n.status)};function Rt(e,t){var n,a,r,o=e.pinnedParticipant||e.orator;if(o)return e.participants[o];for(var i=0,l=Object.values(e.participants);i<l.length;i++){var c=l[i];if(c.peerId!==e.me&&c.wasConnected&&(r||(r=c),!t||(null===(n=c.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)))return c}var s=e.participants[e.me];return!r&&t&&(null===(a=s.mediaSettings)||void 0===a?void 0:a.isVideoEnabled)?s:r}function kt(e,t){return Object.values(e.participants).reduce((function(n,a){return(void 0===t||t(a))&&a.peerId!==e.me&&a.status&&n.push(a),n}),[e.participants[e.me]])}function xt(e){var t=e.participants,n=0;for(var a in t)t.hasOwnProperty(a)&&Ut(e,t[a])&&n++;return n}function Ut(e,t){return t.peerId===e.me||t.status}var Gt=function(){return(Gt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Vt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ht=function(e){var t=e.children,n=e.className,a=Vt(e,["children","className"]),r=Object(s.classNames)("ActivityIndicator",n);return o.a.createElement("span",Gt({},a,{className:r}),t)};Ht.propTypes={className:y.a.string,children:y.a.node};var Bt=Ht,Ft=function(e){var t=e.participant,n=o.a.useContext(D).getLang,a=t.status,r=t.wasConnected;switch(a){case c.CallStatus.WAITING:return r?o.a.createElement(Bt,null,n("calls_status_waiting")):o.a.createElement(_e,{isInverted:!0});case c.CallStatus.CONNECTING:case c.CallStatus.RECONNECT:return o.a.createElement(Bt,null,n("calls_status_connecting"));case c.CallStatus.ERROR:return n("global_error");case c.CallStatus.HANGUP:return o.a.createElement(Bt,null,n("calls_status_hangup"));case c.CallStatus.PERMISSIONS:return n("calls_status_no_permissions");case c.CallStatus.CONNECTED:default:return null}},zt=function(e){var t=e.duration;return o.a.createElement("div",{className:"CallTimer","aria-label":t,"data-duration":t})},Wt=function(){var e=Object(l.useSelector)((function(e){return e})),t=o.a.useContext(D).getLang,n=o.a.useRef(e);o.a.useEffect((function(){n.current=e}),[e]);var a=e.peer,r=V(a)?e.callData.conversation:e.participants[a],i=o.a.useState(),c=i[0],s=i[1],u=o.a.useState(""),p=u[0],d=u[1];return(null==r?void 0:r.status)!==c&&(d(Yt(n,t)),s(null==r?void 0:r.status)),o.a.useEffect((function(){d(Yt(n,t));var e=setInterval((function(){return d(Yt(n,t))}),1e3);return function(){return clearInterval(e)}}),[e]),o.a.createElement(o.a.Fragment,null,p)};function Yt(e,t){var n=e.current;if(!n)return"";var a=n.peer;return V(a)?Jt(n)||Kt(t):function(e,t){if(e.hangupType)switch(e.hangupType){case c.HANGUP_TYPE_BUSY:return t("calls_busy");case c.HANGUP_TYPE_CALLEE_IS_OFFLINE:return t("calls_callee_is_offline");case c.HANGUP_TYPE_REJECTED:return t("calls_rejected_status");case c.HANGUP_TYPE_CANCELED:case c.HANGUP_TYPE_MISSED:case c.HANGUP_TYPE_HUNGUP:case c.HANGUP_TYPE_REMOVED:return null;case c.HANGUP_TYPE_CALLER_IS_BLOCKED:case c.HANGUP_TYPE_EXTERNAL_API_ERROR:case c.HANGUP_TYPE_FAILED:case c.HANGUP_TYPE_NOT_FRIENDS:case c.HANGUP_TYPE_OLD_VERSION:case c.HANGUP_TYPE_SERVICE_DISABLED:case c.HANGUP_TYPE_UNKNOWN_ERROR:case c.HANGUP_TYPE_UNSUPPORTED:return t("global_error")}return null}(n,t)||function(e,t){var n=e.participants[t];return n&&n.status!==c.CallStatus.CONNECTED?o.a.createElement(Ft,{participant:n}):null}(n,a)||Jt(n)||Kt(t)}function Kt(e){return o.a.createElement(Bt,null,e("calls_status_waiting"))}function Jt(e){var t=e.callData.ts;return t?o.a.createElement(zt,{duration:ce(t)}):null}var qt=function(e){var t=e.isGroupCall,n=e.callStatus,a=e.participantCount,i=e.speakers,l=Object(r.useContext)(D).getLang,c=Object(s.classNames)("CallInfo",{"CallInfo--full":t});return o.a.createElement("div",{className:c},o.a.createElement("div",{className:"CallInfo__status"},n,t&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"CallInfo__dot"}," · "),l("calls_participants_plural",a))),t&&i&&o.a.createElement("div",{className:"CallInfo__speakers"},i))};function Xt(){var e=Object(l.useSelector)((function(e){return e})),t=V(e.peer),n=Object(r.useContext)(D),a=n.getLang,i=n.langNumeric,c=Object(r.useState)(0),s=c[0],u=c[1],p=Object(r.useState)(null),d=p[0],f=p[1];return Object(r.useEffect)((function(){u(xt(e))}),[e]),Object(r.useEffect)((function(){if(t){var n=e.speakersInHeader.reduce((function(t,n){return e.participants[n]&&e.participants[n].shortName&&t.push(e.participants[n]),t}),[]);f(n.length>0?a("calls_participants_speak",n.length).replace("{names}",me(n,n.slice(0,3),(function(e){return e.shortName}),a,i)):null)}}),[e.participants,e.speakersInHeader]),o.a.createElement(qt,{isGroupCall:t,callStatus:o.a.createElement(Wt,null),participantCount:s,speakers:d})}var $t=function(){return($t=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Qt={acc:{},timer:0,tasks:0};function Zt(e,t,n,a){nn(t,n,(function(t){e({type:c.UPDATE_PARTICIPANTS_BATCH,data:t})}),a,Qt)}var en={acc:{},timer:0,tasks:0};function tn(e,t,n,a){nn(t,n,(function(t){e({type:c.SET_VISIBLE_PARTICIPANTS,data:t})}),a,en)}function nn(e,t,n,a,r){var o;void 0===a&&(a=30),r.timer?(r.acc[e]=r.acc[e]&&"object"==typeof r.acc[e]?Object.assign(r.acc[e],t):t,r.tasks++):function e(t){n(t),r.timer=window.setTimeout((function(){r.tasks>0&&(e(r.acc),r.acc={},r.tasks=0),clearTimeout(r.timer),r.timer=0}),a)}(((o={})[e]=t,o))}var an=function(){return(an=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function rn(e){var t,n,a,r,i=e.SDK,s=Object(l.useSelector)((function(e){return e})),u=Object(l.useDispatch)(),p=o.a.useContext(D).getLang,d=s.peer,f=V(d),m=f?s.callData.conversation:s.participants[d],h=s.participants[s.me],v=h.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},E=kt(s),_=E.length>1,g=_||v.isVideoEnabled,O=f||E.length>2,b=O&&g&&!s.isOratorMode,C=O&&g&&s.isOratorMode,y=s.uiMode===c.UIMode.FULLSCREEN,S=o.a.useMemo((function(){return i.browser.isScreenCapturingSupported()}),[]),I=null===(t=s.callData)||void 0===t?void 0:t.canFinishCall,N=o.a.useCallback((function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED})}),[]),w=o.a.useCallback((function(){u({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!s.isOratorMode})}),[s.isOratorMode]),P=o.a.useCallback((function(){u({type:c.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!s.isShownParticipantsAside})}),[s.isShownParticipantsAside]),L=o.a.useCallback((function(e,t){u({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:s.pinnedParticipant===t?null:t})}),[s.pinnedParticipant]),T=o.a.useCallback((function(e,t){s.isOratorMode||u({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),s.pinnedParticipant!==t&&u({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[s.isOratorMode,s.pinnedParticipant]),j=o.a.useCallback((function(){u({type:c.MANAGEMENT,isOpen:!0})}),[]),M=o.a.useCallback((function(){var e=!v.isVideoEnabled||v.isScreenSharingEnabled;(e?H(i,!0,!1):Promise.resolve()).then((function(){v.isScreenSharingEnabled&&i.captureScreen(!1),i.toggleLocalVideo(e)})),F.logEvent({call_event_type:e?c.CallActionEventType.VIDEO_ENABLED:c.CallActionEventType.VIDEO_DISABLED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:V(s.peer),reason:e?void 0:"manual"})}),[v]),R=o.a.useCallback((function(){i.captureScreen(!v.isScreenSharingEnabled),F.logEvent({call_event_type:v.isScreenSharingEnabled?c.CallActionEventType.SCREEN_SHARING_STOPPED:c.CallActionEventType.SCREEN_SHARING_STARTED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:V(s.peer)})}),[v.isScreenSharingEnabled,s.screenSharers]),k=o.a.useCallback((function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED}),St(s.peer)}),[s.peer]),x=o.a.useCallback((function(){var e,t,n=!(null===(e=h.statusData)||void 0===e?void 0:e.hand);i.changeParticipantState({hand:n?c.SdkHandType.RAISED:c.SdkHandType.LOWERED}),u({type:c.CHANGE_PARTICIPANT_STATE,participantId:h.peerId,data:an(an({},h.statusData),{hand:!(null===(t=h.statusData)||void 0===t?void 0:t.hand)})}),F.logEvent({call_event_type:n?c.CallActionEventType.HAND_RAISED:c.CallActionEventType.HAND_LOWERED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:V(s.peer)})}),[null===(n=h.statusData)||void 0===n?void 0:n.hand]),G=o.a.useCallback((function(){u({type:c.TOGGLE_POPUP,data:c.POPUP_EXIT})}),[]),B=function(){i.hangup(),F.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:s.callData.callId,peer_id:s.peer,is_group_call:V(s.peer),reason:"none",group_call_users_count:xt(s)})},z=o.a.useCallback((function(){u({type:c.CHANGE_UI_MODE,mode:y?c.UIMode.DEFAULT:c.UIMode.FULLSCREEN}),u({type:c.SET_TOOLTIP,tooltips:null})}),[s.uiMode]),W=o.a.useCallback((function(e,t){var n;u({type:c.SET_TOOLTIP,tooltips:(n={},n[e]=t,n)})}),[]),Y=o.a.useCallback((function(){u({type:c.SET_TOOLTIP,tooltips:null})}),[]),K=o.a.useCallback((function(e){tn(u,e,!1,1e3)}),[]),J=o.a.useCallback((function(e){tn(u,e,!0,1e3)}),[]),q=[{text:p("calls_call_menu_settings"),key:"settings",onClick:function(){H(i,!0,!0).then((function(){u({type:c.TOGGLE_POPUP,data:c.POPUP_SETTINGS})}))}}];return o.a.useEffect((function(){return function(){u({type:c.SET_TOOLTIP,tooltips:null})}}),[]),(null===(a=s.callData.permissions)||void 0===a?void 0:a.MUTE_PARTICIPANTS)&&_&&q.push({text:p("calls_call_menu_mute_all"),key:"muteAll",onClick:function(){i.muteParticipant(),F.logEvent({call_event_type:c.CallActionEventType.ALL_MICS_DISABLED,session_id:s.callData.callId,peer_id:s.peer,is_group_call:V(s.peer)})}}),o.a.createElement(U,{onClose:B,isCautionBoxShown:!0,onBackdropClick:N},o.a.createElement(_t,{id:d,photo:m&&m.photo||"",disablePhoto:g,info:o.a.createElement(Xt,null),callMenuActions:q,isVideoEnabled:v.isVideoEnabled&&!v.isScreenSharingEnabled,isAudioEnabled:v.isAudioEnabled,isScreenSharingEnabled:v.isScreenSharingEnabled,isOratorMode:s.isOratorMode,isFullScreen:y,onToggleVideo:M,onToggleAudio:function(){var e=!v.isAudioEnabled;(e?H(i,!1,!0):Promise.resolve()).then((function(){var t;(null===(t=s.notification)||void 0===t?void 0:t.type)===c.NotificationType.SPEAKING_ON_MUTE&&u({type:c.CALL_NOTIFICATION,notification:null}),i.toggleLocalAudio(e)}))},onToggleScreenShare:R,onLeaveCall:I?G:B,onCollapseCall:N,onToggleOratorMode:w,onFullScreenToggle:z,onTooltipChange:W,onHidePanel:Y,onChat:k,onHandClick:x,isParticipantControlActive:s.isManagementOpen,isLayoutSwitchShown:f&&_,isHandRaised:null===(r=h.statusData)||void 0===r?void 0:r.hand,isHandControlShown:f,isChatControlShown:!!d,isScreenShareControlShown:S,onParticipantsClick:j,chatUnreadCount:s.chatUnreadCount,notification:o.a.createElement(Pt,null),tooltips:s.tooltips,amISpeaking:!!s.speakers[s.me]},!O&&o.a.createElement(Te,an({},function(e,t,n,a){var r,o,i=e[t],l=e[n],c=i.mediaSettings,s=l.mediaSettings;return{hasAudio:!!(null==c?void 0:c.isAudioEnabled),hasVideo:!!(null==c?void 0:c.isVideoEnabled),isSharingScreen:!!(null==c?void 0:c.isScreenSharingEnabled),stream:i.stream,id:t,name:a("calls_own_label"),letter:null===(r=i.name)||void 0===r?void 0:r.slice(0,1),wasConnected:!!i.wasConnected,opponentHasAudio:!!(null==s?void 0:s.isAudioEnabled),opponentHasVideo:!!(null==s?void 0:s.isVideoEnabled),opponentIsSharingScreen:!!(null==s?void 0:s.isScreenSharingEnabled),opponentStream:l.stream,opponentPhoto:l.photo,opponentId:n,opponentName:l.name||n.toString(),opponentLetter:null===(o=l.name)||void 0===o?void 0:o.slice(0,1),opponentWasConnected:!!l.wasConnected}}(s.participants,s.me,s.peer,p))),b&&o.a.createElement(gt,{limit:s.participantLimit},E.map((function(e,t,n){var a,r,l=e.mediaSettings||{},c=l.isVideoEnabled,d=l.isAudioEnabled,f=l.isScreenSharingEnabled,m=e.peerId===s.me?p("calls_own_label"):e.shortName?e.shortName:e.name;return o.a.createElement(Le,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:e.peerId===s.me,isHandRaised:null===(a=e.statusData)||void 0===a?void 0:a.hand,hasVideo:!!c,hasAudio:!!d,isSharingScreen:!!f,isSpeaking:!!s.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:n.length<=8||y?"s":"xs",name:m,letter:null===(r=e.name)||void 0===r?void 0:r.slice(0,1),status:e.status,wasConnected:e.wasConnected,onDblClickParticipant:T,onShow:J,onHide:K,actions:Dt(s,i,u,e,!0,p)})}))),C&&o.a.createElement(Ot,{orator:on(s,p),onToggleParticipantsAside:P,isShownParticipantsAside:s.isShownParticipantsAside},E.map((function(e){var t,n,a=e.mediaSettings||{},r=a.isVideoEnabled,l=a.isAudioEnabled,c=a.isScreenSharingEnabled,d=e.peerId===s.me,f=d?p("calls_own_label"):e.shortName?e.shortName:e.name;return o.a.createElement(Le,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:d,isPinned:e.peerId===s.pinnedParticipant,isHandRaised:null===(t=e.statusData)||void 0===t?void 0:t.hand,hasVideo:!!r,hasAudio:!!l,isSharingScreen:!!c,isSpeaking:!!s.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:"xxs",name:f,letter:null===(n=e.name)||void 0===n?void 0:n.slice(0,1),status:e.status,wasConnected:e.wasConnected,onClickParticipant:L,onShow:J,onHide:K,actions:Dt(s,i,u,e,!0,p)})}))),O&&!g&&o.a.createElement(Ee.default,null,o.a.createElement(A,{id:d,photo:m&&m.photo||"",size:"l",waves:!0,alt:m&&m.tab||""}))))}function on(e,t){var n,a=e.participants[e.pinnedParticipant||e.orator||e.me],r=a.mediaSettings||{},i=r.isVideoEnabled,l=r.isAudioEnabled,c=r.isScreenSharingEnabled,s=a.peerId===e.me;return o.a.createElement(Le,{id:a.peerId,key:a.peerId,isOrator:!0,isInfoShown:!0,isMe:s,hasVideo:!!i,hasAudio:!!l,isSharingScreen:!!c,stream:a.stream,photo:a.photo,photoSize:"l",name:s?t("calls_own_label"):a.name,letter:null===(n=a.name)||void 0===n?void 0:n.slice(0,1),status:a.status,wasConnected:a.wasConnected,allowContain:!0})}var ln=function(e){var t=e.children;return o.a.createElement("div",{className:"CollapsedCall"},t)},cn=function(e){var t=e.id,n=e.photo,a=e.title,r=e.status,i=e.isIncoming,l=e.onClick,c=e.children;return o.a.createElement("div",{className:"CallWidget",onClick:l},o.a.createElement(S,{id:t,photo:n,className:"CallWidget__background"}),o.a.createElement(A,{id:t,photo:n,size:"xs",waves:i,alt:a||""}),o.a.createElement("h1",{className:"CallWidget__name"},o.a.createElement(N.default,{className:""},a)),o.a.createElement("div",{className:"CallWidget__status"},r),c)},sn=function(e){var t=e.localVideoStream,n=e.isLocalAudioEnabled,a=e.isLocalScreenSharing,i=e.participantId,l=e.isMe,c=e.isWithVideo,s=e.isWithAudio,u=e.isScreenSharing,p=e.stream,d=e.photo,f=e.name,m=e.onRestoreCall,h=e.onToggleAudio,v=e.children,E=o.a.useContext(D).getLang,_=Object(r.useState)(!1),g=_[0],O=_[1];Object(r.useEffect)((function(){t||O(!1)}),[t,g]);var b=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),m()}),[m]),C=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),h()}),[h]);return o.a.createElement("div",{className:"CallVideoWidget",onClick:m},t&&o.a.createElement(ve,{stream:t,hasVideo:!0,isMe:!0,isVideoVisible:g,isScreenShareStream:a,setVideoVisibility:O,className:"CallVideoWidget__local",allowContain:!0}),o.a.createElement(Le,{id:i,hasVideo:c,hasAudio:s,isSharingScreen:u,isMe:l,stream:p,photo:d,name:f,photoSize:"s"}),v,o.a.createElement(Me,{alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},o.a.createElement(j.default,{position:"t",align:"left",marginTop:6,text:E(n?"calls_mute":"calls_unmute")},o.a.createElement(T,{type:n?"mute":"unmute",onClick:C}))),o.a.createElement(Me,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},o.a.createElement(j.default,{position:"t",align:"right",text:E("calls_restore"),marginTop:6},o.a.createElement(T,{type:"restore",onClick:b}))))},un=function(){return(un=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},pn=function(e){var t,n,a,i=e.SDK,s=Object(l.useSelector)((function(e){return e})),u=Object(l.useDispatch)(),p=o.a.useContext(D).getLang,d=s.peer,f=le(s),m=V(d)?s.callData.conversation:s.participants[d],h=s.participants[s.me],v=Rt(s,f),E=(null===(t=h.mediaSettings)||void 0===t?void 0:t.isVideoEnabled)&&v&&v.peerId!==s.me,_=Object(r.useCallback)((function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.DEFAULT})}),[]),g=Object(r.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=h.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[s]);return o.a.createElement(ln,null,s.mode===c.Mode.INCOMING&&o.a.createElement(cn,{id:d,title:(null==m?void 0:m.tab)||"",photo:(null==m?void 0:m.photo)||"",status:p("calls_incoming_collapsed"),isIncoming:!0,onClick:_}),s.mode===c.Mode.CALL&&!f&&o.a.createElement(cn,{id:(v?v.peerId:null==m?void 0:m.peerId)||0,title:(null==m?void 0:m.tab)||"",photo:(v?v.photo:null==m?void 0:m.photo)||"",status:o.a.createElement(Wt,null),onClick:_}),s.mode===c.Mode.CALL&&f&&o.a.createElement(sn,un({localVideoStream:E?h.stream:void 0,isLocalAudioEnabled:!!(null===(n=h.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalScreenSharing:!!(null===(a=h.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled)},function(e,t,n){var a,r,o;return e?{participantId:e.peerId,isMe:e.peerId===n,isWithVideo:!!(null===(a=e.mediaSettings)||void 0===a?void 0:a.isVideoEnabled),isWithAudio:!!(null===(r=e.mediaSettings)||void 0===r?void 0:r.isAudioEnabled),isScreenSharing:!!(null===(o=e.mediaSettings)||void 0===o?void 0:o.isScreenSharingEnabled),stream:e.stream,photo:e.photo,name:e.name}:{participantId:t&&t.peerId||0,isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:t&&t.photo||"",name:t&&t.tab||""}}(v,m,s.me),{onRestoreCall:_,onToggleAudio:g})))};var dn=function(){return(dn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function fn(e){var t,n=e.onBeforeCallStart,a=e.onAfterCallFinish,i=Object(l.useSelector)((function(e){return e})),s=Object(r.useRef)(),u=((t={}).incoming=Object(r.useRef)(null),t.outgoing=Object(r.useRef)(null),t.connecting=Object(r.useRef)(null),t.connected=Object(r.useRef)(null),t.end=Object(r.useRef)(null),t),p={controls:!1,preload:"auto"},d=Object(r.useCallback)((function(e){var t=u[e].current;t&&t.paused&&t.play().catch((function(){}))}),[]),f=Object(r.useCallback)((function(e){var t=u[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)}),[]),m=Object(r.useCallback)((function(){Object.keys(u).forEach(f)}),[]),h=Object(r.useCallback)((function(e){var t=u[e].current;if(t){var n=t.volume;t.volume=0,t.play().catch((function(){})),t.pause(),t.currentTime=0,t.volume=n}}),[]),v=Object(r.useCallback)((function(){n&&n()}),[n]),E=Object(r.useCallback)((function(){a&&a()}),[a]);return Object(r.useEffect)((function(){return q.browser.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(u).forEach(h),document.body.removeEventListener("mousedown",e)})),function(){m(),E()}}),[]),Object(r.useEffect)((function(){var e,t,n=s.current||i,a=i;n.mode!==a.mode&&(n.mode!==c.Mode.READY||a.mode!==c.Mode.INCOMING&&a.mode!==c.Mode.CALL||v(),n.mode===c.Mode.INCOMING&&f("incoming"),a.mode===c.Mode.INCOMING&&d("incoming"),a.mode!==c.Mode.READY||n.mode!==c.Mode.INCOMING&&n.mode!==c.Mode.CALL||(m(),d("end"),E()));var r=a.me,o=n.participants,l=a.participants,u=null===(e=o[r])||void 0===e?void 0:e.status,p=null===(t=l[r])||void 0===t?void 0:t.status;u!==p&&(u===c.CallStatus.CONNECTING&&f("connecting"),p===c.CallStatus.CONNECTING&&d("connecting"));var h=Object.keys(l).some((function(e){return o[e]&&o[e].status===c.CallStatus.CONNECTED})),_=Object.keys(l).some((function(e){var t=o[e],n=l[e];return t&&t.status!==n.status&&n.status===c.CallStatus.CONNECTED}));!h&&_&&d("connected"),a.mode===c.Mode.CALL&&(!function(e,t,n,a){for(var r=!1,o=0,i=Object.values(e);o<i.length;o++){var l=i[o];if(l.peerId!==t){if(l.status===c.CallStatus.CONNECTED)return!1;l.status===c.CallStatus.WAITING&&(!a||n.has(l.peerId))&&(r=!0)}}return r}(l,r,a.participantsAddedByMe,V(i.peer))?f("outgoing"):d("outgoing")),s.current=i}),[i]),o.a.createElement(o.a.Fragment,null,o.a.createElement("audio",dn({src:"/mp3/call_incoming.mp3",ref:u.incoming,loop:!0},p)),o.a.createElement("audio",dn({src:"/mp3/call_outgoing.mp3",ref:u.outgoing,loop:!0},p)),o.a.createElement("audio",dn({src:"/mp3/call_connected.mp3",ref:u.connected,loop:!1},p)),o.a.createElement("audio",dn({src:"/mp3/call_connecting.mp3",ref:u.connecting,loop:!0},p)),o.a.createElement("audio",dn({src:"/mp3/call_end.mp3",ref:u.end,loop:!1},p)))}var mn=n("Ht+d"),hn=n("Xq7/"),vn=n("7ZXl"),En=function(e){var t=e.title,n=e.onCloseModal,a=e.hint,r=e.actionButtons,i=e.isWithBackButton,l=e.onBackClick,c=e.children,s=o.a.useContext(D).getLang;return o.a.createElement(R.default,{className:"CallManagementModal",disableBodyScroll:!1,onClose:n},o.a.createElement(hn.ModalHeader,{title:t,onClose:n,appearance:"blue",backText:i?s("global_back"):void 0,onBack:l}),o.a.createElement("div",{className:"CallManagementModal__content"},o.a.Children.toArray(c).map((function(e,t){return o.a.createElement("div",{className:"CallManagementModal__section",key:t},e)}))),(r||a)&&o.a.createElement(vn.ModalFooter,{actionButtons:r||[],hint:a}))},_n=n("FABD"),gn=function(e){var t=e.tokens,n=e.onRemoveToken,a=e.value,r=e.onChange,i=e.onSelect,l=e.renderSuggest,c=e.data,s=o.a.useContext(D).getLang;return o.a.createElement(_n.default,{className:"CallsMultiSelect",tokens:t,removeTokenPlaceholder:s("calls_remove_token"),onRemoveToken:n,placeholder:s("calls_search_participants_placeholder"),value:a,onChange:r,onSelect:i,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:function(){},notFoundText:s("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:c})},On=n("t7n3"),bn=function(e){var t=e.headingElement,n=void 0===t?"h3":t,a=e.extra,r=e.className,i=e.children,l=n;return o.a.createElement("header",{className:Object(s.classNames)("ListHeader",r)},o.a.createElement(l,{className:"ListHeader__text"},i),o.a.createElement("span",{className:"ListHeader__extra"},a))},Cn=n("xGYt"),yn=n("NsuH");function Sn(e){var t=e.member,n=e.selected,a=e.disabled,o=Object(s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":n,"ParticipantSuggest--disabled":a});return r.createElement("div",{className:o,"data-id":t.id},r.createElement(yn.default,{size:"34",title:t.name,photo:t.photo}))}Sn.defaultProps={selected:!1,disabled:!1};var In=function(){return(In=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},An=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Nn=function(e){var t=e.children,n=e.className,a=An(e,["children","className"]);return o.a.createElement("button",In({className:Object(s.classNames)("ListMore",n)},a),t)},wn=function(){return(wn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Pn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ln=function(e){var t=Pn(e,[]);return o.a.createElement("svg",wn({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"}))},Tn=function(e){var t=e.data,n=e.onClick,a=e.selected,r=e.disabled;if("type"in t)switch(t.type){case c.SearchResultType.HEADER:return o.a.createElement(bn,{className:"CallsSearchResult CallsSearchResult--header",extra:t.count},t.text);case c.SearchResultType.CALL_ALL_IN_CHAT:return o.a.createElement("div",{className:"CallsSearchResult CallsSearchResult--select"},o.a.createElement(mn.default,{appearance:"secondary",wide:!0,onClick:n},o.a.createElement("span",{className:"CallsSearchResult__icon"},o.a.createElement(Ln,null)),t.text));case c.SearchResultType.MEMBERS_MORE:case c.SearchResultType.FRIENDS_MORE:return o.a.createElement(Nn,{onClick:n},t.text)}return o.a.createElement(Cn.default,{"data-id":t.peerId,onClick:n,selectable:!r},o.a.createElement(Sn,{member:t,selected:a,disabled:r}))},jn=function(){return(jn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Dn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a},Mn=function(e){var t=e.onChange,n=e.onClickCallAll,a=Object(l.useSelector)((function(e){return e})),i=o.a.useContext(D).getLang,s=(a.preselectedIds||[]).filter((function(e){return!Tt(e)})),u=Object(r.useState)(s),p=u[0],d=u[1],f=Object(r.useState)(""),m=f[0],h=f[1],v=Object(r.useState)({}),E=v[0],_=v[1],g=Object(r.useState)(!1),O=g[0],b=g[1],C=Object(r.useState)(!1),y=C[0],S=C[1],I=Object(r.useState)(function(e,t){var n=e.reduce((function(e,t){return e[t.id]=!0,e}),{});return t.filter((function(e){return!n[e.id]}))}(a.chatMembers,a.friends))[0],A=Object(r.useState)(function(e,t){return[].concat(t,e).reduce((function(e,t){return e[t.id]=t,e}),{})}(a.chatMembers,I))[0],N=Object(r.useCallback)((function(e){return e.name}),[]),w=Object(r.useCallback)((function(e){return e.peerId}),[]),P=x(Dn(a.chatMembers,I),N,w),L=Object(r.useCallback)((function(e){return e?P.search(e):function(e,t,n,a,r,o){var i={type:c.SearchResultType.MEMBERS_MORE,text:o("calls_show_all_members")},l={type:c.SearchResultType.FRIENDS_MORE,text:o("calls_show_all_friends")},s={type:c.SearchResultType.HEADER,text:o("calls_chat_members"),count:e.length},u={type:c.SearchResultType.HEADER,text:o("calls_friends")},p={type:c.SearchResultType.CALL_ALL_IN_CHAT,text:o("calls_call_all")},d=[];if(e.length>0)if(d.push(s),e.length<=r&&d.push(p),n||e.length<=5)d.push.apply(d,e);else{for(var f=0;f<5;f++)d.push(e[f]);d.push(i)}if(d.push(u),a||t.length<=10)d.push.apply(d,t);else{for(f=0;f<10;f++)d.push(t[f]);d.push(l)}return d}(a.chatMembers,I,O,y,a.participantLimit,i)}),[a,O,y]),T=Object(r.useState)(L(m)),j=T[0],M=T[1],R=function(e){d(e),t(e)},k=Object(r.useCallback)((function(e){return R(Dn(p,[+e]))}),[p]),U=Object(r.useCallback)((function(e){return R(p.filter((function(t){return t!==+e})))}),[p]),G=kt(a).map((function(e){return{id:e.peerId.toString(),text:Object(On.unclean)(e.name),locked:!0}})).concat(p.map((function(e){return{text:Object(On.unclean)(A[e].name),id:e.toString(),locked:!1}})));Object(r.useEffect)((function(){_(p.reduce((function(e,t){return e[t]=!0,e}),{}))}),[]),Object(r.useEffect)((function(){M(L(m))}),[p,O,y]);var V=Object(r.useCallback)((function(e){h(e.target.value),M(L(e.target.value))}),[]),H=Object(r.useCallback)((function(e){var t;return U(e),_(jn(jn({},E),((t={})[e]=!1,t))),Promise.resolve()}),[E]),B=Object(r.useCallback)((function(e){var t,n;return Rn(e,a,E)?(U(e),_(jn(jn({},E),((t={})[e]=!1,t)))):kn(e,a,G,E)||(k(e),_(jn(jn({},E),((n={})[e]=!0,n))),h(""),M(L(""))),Promise.resolve()}),[p,a,E]),F=Object(r.useCallback)((function(){var e=kt(a).reduce((function(e,t){return e[t.peerId]=!0,e}),{}),t=a.chatMembers.reduce((function(t,n){var r=n.peerId;return e[r]||kn(r||0,a,G,E)||t.push(r),t}),[]);n(t)}),[a,p,E]),z=Object(r.useCallback)((function(e,t){if(!("type"in e))return t;switch(e.type){case c.SearchResultType.CALL_ALL_IN_CHAT:return function(){return F()};case c.SearchResultType.MEMBERS_MORE:return function(){return b(!0)};case c.SearchResultType.FRIENDS_MORE:return function(){return S(!0)};default:return function(){}}}),[F]);return o.a.createElement(gn,{tokens:G,onRemoveToken:H,value:m,onChange:V,onSelect:B,renderSuggest:function(e,t){return o.a.createElement(Tn,{data:e,onClick:z(e,t),selected:Rn(e.peerId||0,a,E),disabled:kn(e.peerId||0,a,G,E),key:e.peerId||e.text})},data:j})};function Rn(e,t,n){return n&&n[e]||Mt(t,e)}function kn(e,t,n,a){return!!Mt(t,e)||!Rn(e,t,a)&&(n.length>=t.participantLimit||!Object(G.isUserPeer)(e))}var xn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a},Un=function(e){var t=e.SDK,n=e.isWithBackButton,a=e.onBackClick,i=Object(l.useSelector)((function(e){return e})),s=Object(l.useDispatch)(),u=o.a.useContext(D).getLang,p=Object(r.useState)(i.preselectedIds||[]),d=p[0],f=p[1],m=Object(r.useState)(xt(i))[0]+d.length,h=function(){s({type:c.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),s({type:c.MANAGEMENT,isOpen:!1})},v=0===d.length,E=function(e){h(),s({type:c.MANUAL_ADD_PARTICIPANTS,participants:e}),e.forEach(t.addParticipant);var n=ne(function(e,t){var n=e.chatData||e.callData.conversation,a=t.reduce((function(t,n){return e.participants[n]||t.set(n,!0),t}),new Map);if(0===a.size)return[n,[]];var r=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,o=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,i=r.reduce((function(e,t){return a.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=i.smallerListData,c=i.smallerListMap;if(l.length===a.size)return[n,l];var s=o.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[n,xn(l,s)]}(i,e)),a=n[0],r=n[1];s({type:c.LOAD_PEERS,conversation:a,members:r}),F.logEvent({call_event_type:c.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:i.callData.callId,peer_id:i.peer.toString(),is_group_call:V(i.peer),group_call_users_count:d.length})},_=Object(r.useCallback)((function(){E(d)}),[d]);return o.a.createElement(En,{title:u("calls_add_participants_to_call"),onCloseModal:h,actionButtons:o.a.createElement(mn.default,{key:"add",disabled:v,onClick:_},u("global_add")),hint:Gn(m,i.participantLimit,u),isWithBackButton:n,onBackClick:n?a:function(){}},o.a.createElement(Mn,{onChange:f,onClickCallAll:function(e){E(e)}}))};function Gn(e,t,n){return e<2?n("calls_management_add_warning"):n("calls_selected").replace("{selected}",""+e).replace("{limit}",""+t)}var Vn=n("aFGQ"),Hn=function(){return(Hn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Bn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Fn=function(e){var t=e.isSingleLine,n=e.className,a=e.children,r=Bn(e,["isSingleLine","className","children"]),i=Object(s.classNames)("InputStub",n,{"InputStub--singleLine":t});return o.a.createElement("div",Hn({className:i},r),a)};function zn(){return(zn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var Wn=r.useRef,Yn=r.useEffect;function Kn(e){var t=e.cameras,n=e.mics,a=e.currentCamId,o=e.currentMicId,i=e.isCamAvailable,l=e.isMicAvailable,c=e.onCameraChange,s=e.onMicChange,u=r.useContext(D).getLang,p=Wn(null),d=Wn(null),f=Wn(null),m=Wn(null),h={controls:!1,crossOrigin:"anonymous",playsInline:"playsinline"};return qn({kind:"video",mediaElRef:p,streamRef:f,deviceId:a,isActive:i}),qn({kind:"audio",mediaElRef:d,streamRef:m,deviceId:o,isActive:l}),r.createElement("div",{className:"CallSettings"},r.createElement("div",{className:"CallSettings__camera"},i?r.createElement("video",zn({ref:p},h,{className:"CallSettings__cameraStream CallSettings__cameraContent"})):r.createElement("div",{className:"CallSettings__cameraStub CallSettings__cameraContent"},u("calls_no_camera"))),l&&r.createElement("audio",zn({ref:d},h)),r.createElement("div",{className:"CallSettings__block"},r.createElement("div",{className:"CallSettings__label"},r.createElement("span",{className:"CallSettings__labelContent"},u("calls_settings_camera"))),i?r.createElement(Vn.default,{options:t.map(Jn),value:a,onChange:e=>{var t=e.selected;return c(t.value)},appearance:"secondary",className:"CallSettings__field"}):r.createElement(Fn,{className:"CallSettings__field"},u("calls_settings_no_camera"))),r.createElement("div",{className:"CallSettings__block"},r.createElement("div",{className:"CallSettings__label"},r.createElement("span",{className:"CallSettings__labelContent"},u("calls_settings_mic"))),l?r.createElement(Vn.default,{options:n.map(Jn),value:o,onChange:e=>{var t=e.selected;return s(t.value)},appearance:"secondary",className:"CallSettings__field"}):r.createElement(Fn,{className:"CallSettings__field"},u("calls_settings_no_mic"))))}function Jn(e){return{value:e.deviceId,label:e.label}}function qn(e){var t=e.kind,n=e.mediaElRef,a=e.streamRef,r=e.deviceId,o=e.isActive,i={video:!1,audio:!1};Yn(()=>{o&&navigator.mediaDevices.getUserMedia(zn({},i,{[t]:{deviceId:r}})).then(e=>{var t=a.current;t&&t.getTracks().forEach(e=>e.stop());var r=n.current;r&&(a.current=e,r.srcObject=e,r.volume=0,r.play(),se(n))}).catch(e=>{console.error("Error occurred: "+e)})},[r,o]),Yn(()=>()=>{var e=a.current;e&&e.getTracks().forEach(e=>e.stop());var t=n.current;t&&(t.srcObject=null)},[])}Kn.defaultProps={cameras:[],mics:[],currentCamId:"",currentMicId:"",isCamAvailable:!1,isMicAvailable:!1};var Xn=n("0toi");function $n(e){var t=e.onClose,n=e.onSubmit,a=e.children,o=r.useContext(D).getLang;return r.createElement(Xn.default,{onClose:t,title:o("calls_settings"),appearance:"blue",actionButtons:r.createElement(r.Fragment,null,r.createElement(mn.default,{onClick:t,appearance:"tertiary"},o("global_cancel")),r.createElement(mn.default,{onClick:n},o("global_save"))),className:"CallSettingsModal"},a)}var Qn=o.a.useState;function Zn(e){var t=e.SDK,n=Object(l.useSelector)((function(e){var t;return[e.mode,null===(t=e.participants[e.me].mediaSettings)||void 0===t?void 0:t.isVideoEnabled]})),a=n[0],r=n[1],i=Object(l.useDispatch)(),s=t.browser.getCameras(),u=t.browser.getMicrophones(),p=t.browser.hasCamera()&&t.browser.hasCameraPermission(),d=t.browser.hasMicrophone()&&t.browser.hasMicrophonePermission(),f=t.browser.getSavedCamera(),m=t.browser.getSavedMicrophone(),h=p&&(f&&f.deviceId||s[0].deviceId),v=d&&(m&&m.deviceId||u[0].deviceId),E=Qn(h),_=E[0],g=E[1],O=Qn(v),b=O[0],C=O[1];return o.a.createElement($n,{onClose:function(){i({type:c.TOGGLE_POPUP})},onSubmit:function(){var e=[Promise.resolve()];!f&&h===_&&a!==c.Mode.READY&&!r||f&&f.deviceId===_||e.push(t.changeDevice("videoinput",_)),m&&m.deviceId===b||e.push(t.changeDevice("audioinput",b)),Promise.all(e).then((function(){i({type:c.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),i({type:c.TOGGLE_POPUP})}))}},o.a.createElement(Kn,{mics:u,cameras:s,currentCamId:_,currentMicId:b,isCamAvailable:p,isMicAvailable:d,onCameraChange:function(e){return g(e)},onMicChange:function(e){return C(e)}}))}class ea extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){switch(this.props.mode){case c.Mode.CALL:this.props.SDK.hangup();break;case c.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)}render(){return this.state.hasError?null:this.props.children}}var ta,na=n("enZq");!function(e){e.BLUE="blue",e.GREEN="green",e.GRAY="gray",e.RED="red"}(ta||(ta={}));var aa=function(e){var t=e.icon,n=e.color;return o.a.createElement("div",{className:Object(s.classNames)("ListIcon","ListIcon--"+n)},t)},ra=function(){return(ra=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},oa=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ia=function(e){var t=oa(e,[]);return o.a.createElement("svg",ra({width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{"aria-hidden":"true"}),o.a.createElement("path",{d:"M6.022 9.184a.837.837 0 01-1.187-.001 3.861 3.861 0 010-5.419l2.618-2.643a3.772 3.772 0 015.366 0c1.261 1.274 1.557 3.033.67 4.508-.296.49-.947.47-1.325.09-.275-.276-.254-.707-.077-1.019.465-.817.24-1.683-.456-2.379a2.094 2.094 0 00-2.997 0L6.023 4.956a2.143 2.143 0 00-.001 3.025.83.83 0 010 1.202zm1.95-3.166c.833.835.832 2.19-.001 3.025L5.36 11.68a2.094 2.094 0 01-2.998 0c-.695-.696-.91-1.555-.446-2.371.178-.313.199-.744-.076-1.019-.379-.38-1.03-.4-1.325.09-.888 1.474-.602 3.226.659 4.5a3.772 3.772 0 005.367 0l2.617-2.643a3.861 3.861 0 000-5.419.837.837 0 00-1.187 0 .83.83 0 000 1.2z"}))},la=function(e){var t=e.text,n=e.onCopyDone,a=e.children,i=Object(r.useRef)(null),l=Object(r.useCallback)((function(e){i.current&&(i.current.focus(),i.current.select(),document.execCommand("copy"),e.preventDefault(),e.stopPropagation(),n&&n())}),[n]);return o.a.createElement("div",{className:"CopyText",onClick:l},o.a.createElement("input",{type:"text",readOnly:!0,value:t||"",ref:i,className:"CopyText__input"}),a)},ca=n("754W"),sa=n("XTb9"),ua=function(e){var t=e.value,n=e.copyText,a=e.doneText,i=e.className,l=Object(r.useState)(!1),c=l[0],u=l[1],p=Object(r.useCallback)((function(){u(!0)}),[]),d=Object(r.useCallback)((function(){u(!1)}),[]),f=Object(s.classNames)("ListCopyControl",i,{"ListCopyControl--copied":c});return o.a.createElement("div",{className:f},o.a.createElement(la,{text:t,onCopyDone:p},o.a.createElement(ca.default,{className:"ListCopyControl__copyButton"},n)),o.a.createElement(sa.default,{shown:c,callback:d,className:"ListCopyControl__copyDone"},a))},pa=function(e){var t=e.isLinkBlockShown,n=e.onLinkBlockClick,a=e.callUrlLink,r=o.a.useContext(D).getLang;return o.a.createElement(na.default,null,t&&o.a.createElement(Cn.default,{onClick:n,chevron:!0,icon:o.a.createElement(aa,{icon:o.a.createElement(ia,null),color:ta.GREEN})},r("calls_menu_link"),a&&o.a.createElement(ua,{value:a,copyText:r("calls_menu_link_copy"),doneText:r("calls_menu_link_copied")})))},da=n("dLHM"),fa=n("Q3mP"),ma=function(e){var t=e.link,n=void 0===t?"":t,a=e.isLinkLoading,i=o.a.useContext(D).getLang,l=Object(r.useState)(!1),c=l[0],s=l[1],u=Object(r.useCallback)((function(){return s(!0)}),[]),p=Object(r.useCallback)((function(){return s(!1)}),[]);return o.a.createElement("div",{className:"CallLink"},o.a.createElement("p",{className:"CallLink__info"},i("calls_management_link_info")),a?o.a.createElement(Fn,{className:"CallLink__input"},o.a.createElement(fa.default,null)):o.a.createElement(da.default,{readOnly:"readonly",className:"CallLink__input",value:n}),o.a.createElement(la,{text:n,onCopyDone:u},o.a.createElement(mn.default,{disabled:a},i("calls_link_copy"))),o.a.createElement(sa.default,{className:"CallLink__copied",shown:c,callback:p},i("calls_link_copied")))},ha=n("grKM"),va=function(e){var t=e.searchQuery,n=e.onSearchChange,a=e.length,r=e.children,i=o.a.useContext(D).getLang;return o.a.createElement("div",{className:"CallParticipantList"},o.a.createElement(ha.BlockSearchInput,{value:t,placeholder:i("calls_search_participants_placeholder"),onChange:n,onInput:n,onPaste:n,className:"CallParticipantList__input"}),o.a.createElement(bn,{extra:a||""},i("calls_participant_list_header")),o.a.createElement(na.default,{border:!1,className:"CallParticipantList__list"},r))},Ea=function(){return(Ea=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},_a=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ga=function(e){var t=e.element,n=void 0===t?"span":t,a=e.alt,r=e.className,i=_a(e,["element","alt","className"]),l=n,c=Object(s.classNames)("ListActionsControl",r);return o.a.createElement(l,Ea({"aria-label":a,className:c},i),o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"5",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},o.a.createElement("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"})))},Oa=n("As6E"),ba=function(e){var t=e.position,n=e.align,a=e.trigger,r=e.marginTop,i=e.marginLeft,l=e.actions;return l.length>0?o.a.createElement(Oa.default,{position:t,align:n,trigger:a,marginTop:r,marginLeft:i,className:"ParticipantMenu__dropdown",data:l},o.a.createElement(ga,null)):null},Ca=function(e){var t=e.SDK,n=e.participant,a=Object(l.useSelector)((function(e){return e})),r=Object(l.useDispatch)(),i=o.a.useContext(D).getLang,c=Dt(a,t,r,n,!1,i);return c.length>0?o.a.createElement(ba,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:c}):null},ya=function(){return(ya=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Sa=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ia=function(e){var t=Sa(e,[]);return o.a.createElement("svg",ya({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},t),o.a.createElement("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"}))},Aa=function(){return(Aa=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Na=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},wa=function(e){var t=Na(e,[]);return o.a.createElement("svg",Aa({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"}))},Pa=function(){return o.a.createElement("div",{className:"VolumeMeterAnimation"})},La=function(e){var t=e.showSpeaking,n=e.showAudioDisabled,a=e.showRaisedHand,r=e.showConnecting;return o.a.createElement("span",{className:"ParticipantIndicators"},t&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(Pa,null)),n&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(Ia,{className:"ParticipantIndicators__muted"})),a&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(wa,{className:"ParticipantIndicators__hand"})),r&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(_e,null)))},Ta=function(){return(Ta=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ja=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Da=function(e){var t=e.className,n=e.children,a=(e.type,ja(e,["className","children","type"])),r=Object(s.classNames)("ListAddControl",t);return o.a.createElement("button",Ta({className:r},a),o.a.createElement("span",{className:"ListAddControl__icon"},o.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0},o.a.createElement("path",{d:"M9 7h6c.552 0 1 .448 1 1s-.448 1-1 1h-6v6c0 .552-.448 1-1 1s-1-.448-1-1v-6h-6c-.552 0-1-.448-1-1s.448-1 1-1h6v-6c0-.552.448-1 1-1s1 .448 1 1z",fill:"currentColor"}))),n)},Ma=function(e){var t=e.SDK,n=e.onAddClick,a=Object(l.useSelector)((function(e){return e})),i=o.a.useContext(D).getLang,s=function(e){return Object.values(e.participants).reduce((function(t,n){return(n.peerId===e.me||n.status)&&(t[0].push(n),n.name&&t[1].push(n)),t}),[[],[]])}(a),u=s[0],p=s[1],d=Object(r.useState)(""),f=d[0],m=d[1],h=Object(r.useCallback)((function(e){return e.name}),[]),v=Object(r.useCallback)((function(e){return e.peerId}),[]),E=x(p,h,v),_=f?E.search(f):u,g=Object(r.useCallback)((function(e){m(e.target.value)}),[]),O=!Tt(a.me);return o.a.createElement(va,{searchQuery:f,onSearchChange:g,length:_.length},!f&&O&&o.a.createElement(Cn.default,{selectable:!1,border:!1,key:"add"},o.a.createElement(Da,{onClick:n},i("calls_add_participants"))),_.length>0&&_.map((function(e){var n,r,i=e.peerId!==a.me&&e.status===c.CallStatus.WAITING,l=!i&&!(null===(n=e.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),s=!i&&!!(null===(r=e.statusData)||void 0===r?void 0:r.hand),u=!!a.speakers[e.peerId],p=i||l||s||u;return o.a.createElement(Cn.default,{selectable:!1,border:!1,key:e.peerId,aside:o.a.createElement(o.a.Fragment,null,p&&o.a.createElement(La,{showSpeaking:u,showRaisedHand:s,showAudioDisabled:l,showConnecting:i,key:"indicators"}),o.a.createElement(Ca,{SDK:t,participant:e,key:"menu"}))},o.a.createElement(yn.default,{photo:o.a.createElement(A,{id:e.peerId,photo:e.photo,alt:e.name||"",size:"xxxs"}),title:e.name,href:e.link,target:"_blank"}))})),f&&0===_.length&&o.a.createElement(Ee.default,null,i("calls_participants_not_found")))};function Ra(e,t){return[function(){return ka(e).imHash},function(e){return t({type:c.UPDATE_HASH,hash:e}),e}]}function ka(e){return"current"in e?e.current:e}var xa,Ua=n("ER42"),Ga=n("vT4u"),Va=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(Ua.post)(Ga.CONTROLLER,{act:"a_load_call_peers",peerId:+t,memberIds:n,hash:e,anonymId:a})},Ha=(e,t)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_chat_members",chat:t,hash:e}),Ba=e=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_calls_token",hash:e}),Fa=(e,t)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_call_link",hash:e,callId:t}),za=e=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_friends",hash:e}),Wa=(e,t)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_force_call_finish",hash:e,callId:t}),Ya=(e,t,n)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_active_call_data",peer_id:t,hash:e,userId:n,get_chat_counters:!0}),Ka=(e,t,n,a,r)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_load_call_participants",callId:t,peerIds:n,userId:a,hash:e,withConversation:r.withConversation,withChatMembers:r.withChatMembers,withCallParticipants:r.withCallParticipants}),Ja=(e,t)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_log_call_received",callId:e,hash:t}),qa=function(e){var t=e.id;return{peerId:t,id:t,name:e.name,link:e.link,photo:e.photo,sex:e.sex,firstName:e.first_name,lastName:e.last_name}},Xa=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a};function $a(e,t){var n=Ra(e,t),a=n[0],r=n[1];return ka(e).friends.length>0?Promise.resolve():(window.curFastChat&&window.curFastChat.friends?Promise.resolve([window.curFastChat.friends]):ue(za,fe.bind(null,a,r))()).then((function(e){var n=e[0],a=Object.entries(n).map((function(e){var t=e[0],n=e[1],a=n[0],r=n[1],o=n[2],i=n[4],l=n[5];return{id:parseInt(t),peerId:parseInt(t),name:a,photo:r,firstName:o,link:l,sex:i}}));t({type:c.SET_FRIENDS,data:a})}))}function Qa(e,t,n,a){var r=Ra(e,t),o=r[0],i=r[1];return ue(Ha,fe.bind(null,o,i))(n).then((function(n){var r=n[0][2];t({type:c.SET_CHAT_INFO,data:r.map(qa).sort((function(t,n){var a=ka(e).me;return t.peerId===a?-1:n.peerId===a?1:0})),conversation:a})}))}function Za(e,t,n,a){var r=Ra(e,t),o=r[0],i=r[1];return ue(Va,(function(e){return fe(o,i,e)}))(n,a).then(yt).then((function(e){var a=ae(e),r=a[0],o=a[1];t({type:c.LOAD_PEERS,conversation:r,members:o,peerId:n})}))}function er(e,t,n){if(!n)return Promise.resolve();var a=Ra(e,t),r=a[0],o=a[1],i=ka(e).me,l=i<0?i:void 0;return ue(Ya,(function(e){return fe(r,o,e)}))(n,l).then((function(e){var n=e[0];n&&(t({type:c.CALL_STATE,callData:{canFinishCall:n.can_finish_call,hasUrlLink:n.has_link}}),(n.chat_unread_count||n.chat_up_to_msg_id)&&t({type:c.SET_UNREAD_COUNT,chatUnreadCount:n.chat_unread_count,chatUpToMsgId:n.chat_up_to_msg_id}))}))}function tr(e,t,n,a,r){var o=Ra(e,t),i=o[0],l=o[1],s=ka(e).me,u=s<0?s:void 0;return ue(Ka,(function(e){return fe(i,l,e)}))(n,a,u,r).then((function(e){var t=e[0],n=t.conversation,a=t.anonyms,o=t.profiles,i=Xa(Object.values(a),Object.values(o)),l=yt([n||{},i]);return r.awaitImages?l.then((function(){return[n,i]})):[n,i]})).then((function(e){var n=e[0],a=e[1];t({type:c.LOAD_PEERS,conversation:n,members:a})})).catch((function(e){return console.error(e)}))}function nr(e,t,n,a){var r=t.callData.callId,o=function(){return t.imHash},i=function(e){return n({type:c.UPDATE_HASH,hash:e}),e};n({type:c.SHOW_LOADER,isLoaderVisible:!0}),ue(Wa,(function(e){return fe(o,i,e)}))(r).catch((function(e){console.error(e),n({type:c.ERROR,text:a("calls_error_force_call_finish"),handleType:c.ErrorHandleType.FATAL})})).finally((function(){n({type:c.SHOW_LOADER,isLoaderVisible:!1})}))}!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS"}(xa||(xa={}));var ar=function(e){var t,n,a=e.SDK,i=Object(l.useSelector)((function(e){return e})),s=Object(l.useDispatch)(),u=Object(r.useState)(i.callData.callUrlLink||""),p=u[0],d=u[1],f=Object(r.useState)(xa.MAIN),m=f[0],h=f[1],v=Object(r.useState)(!1),E=v[0],_=v[1],g=!!(null===(t=i.callData.conversation)||void 0===t?void 0:t.canAddMembers),O=null===(n=i.callData)||void 0===n?void 0:n.canFinishCall,b=o.a.useContext(D).getLang,C=Object(r.useCallback)((function(){s({type:c.MANAGEMENT,isOpen:!1})}),[]),y=Object(r.useCallback)((function(){h(xa.MAIN)}),[]),S=Object(r.useCallback)((function(){if(h(xa.CALL_LINK),!p){var e=i.callData.callId||"";_(!0),function(e,t,n){var a=Ra(e,t),r=a[0],o=a[1];return ue(Fa,(function(e){return fe(r,o,e)}))(n).then((function(e){var n=e[0];return t({type:c.CALL_STATE,callData:{callUrlLink:n}}),n}))}(i,s,e).then((function(e){d(e),_(!1)})).catch((function(e){console.error(e),_(!1),s({type:c.ERROR,text:b("calls_get_url_link_error_text")}),h(xa.MAIN)}))}}),[i.callData.callId,p]),I=Object(r.useCallback)((function(){s({type:c.SHOW_LOADER,isLoaderVisible:!0});var e=[$a(i,s)].concat(Object(G.isChatPeer)(i.peer)?[Qa(i,s,i.peer,i.callData.conversation)]:[]);return Promise.all(e).then((function(){s({type:c.SHOW_LOADER,isLoaderVisible:!1}),h(xa.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),s({type:c.SHOW_LOADER,isLoaderVisible:!1})}))}),[i.peer,i.callData]),A=Object(r.useCallback)((function(){s({type:c.TOGGLE_POPUP}),nr(0,i,s,b)}),[i.callData.callId,i.imHash]);return o.a.createElement(o.a.Fragment,null,m===xa.MAIN&&o.a.createElement(En,{title:b("calls_management_participants"),actionButtons:(O?[o.a.createElement(mn.default,{onClick:A,key:"forceCallFinish",appearance:"secondary"},b("calls_force_call_finish"))]:[]).concat([o.a.createElement(mn.default,{onClick:a.hangup,key:"leave"},b("calls_leave_call"))]),onCloseModal:C},o.a.createElement(pa,{isLinkBlockShown:g,onLinkBlockClick:S,callUrlLink:p}),o.a.createElement(Ma,{SDK:a,onAddClick:I})),m===xa.CALL_LINK&&o.a.createElement(En,{title:b("calls_management_link"),hint:b("calls_management_add_warning"),onCloseModal:C,isWithBackButton:!0,onBackClick:y},o.a.createElement(ma,{link:p,isLinkLoading:E})),m===xa.ADD_PARTICIPANTS&&o.a.createElement(Un,{SDK:a,isWithBackButton:!0,onBackClick:y}))},rr=function(e){var t=e.children;return o.a.createElement("h2",{className:"JoinHeader"},t)},or=function(e){var t=e.children;return o.a.createElement("div",{className:"VisuallyHidden"},t)},ir=function(e){var t=e.items;return o.a.createElement("figure",{className:"AvatarsStack"},o.a.createElement(or,null,o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},o.a.createElement("defs",null,o.a.createElement("clipPath",{id:"users-mask"},o.a.createElement("path",{d:"M43.56 8.25a25 25 0 100 33.5A27.88 27.88 0 0138 25c0-6.28 2.07-12.08 5.56-16.75z"}))))),t.map((function(e,t){return"src"in e?o.a.createElement("img",{src:e.src,className:"AvatarsStack__item",alt:e.alt,key:e.key||t}):o.a.createElement(I.ConversationNoPhoto,{text:e.text,id:e.id,size:"50",className:"AvatarsStack__item",key:e.key||t})})))},lr=function(){return(lr=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},cr=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},sr=function(e){var t=cr(e,[]);return o.a.createElement("svg",lr({width:"16",height:"16",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),o.a.createElement("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"}))},ur=function(e){var t=e.isAnonym,n=e.title,a=e.label,r=e.items,i=e.onChangeName,l=e.name,c=e.namePlaceholder,u=e.joinWithVideoText,p=e.joinWithAudioText,d=e.onJoinWithVideo,f=e.onJoinWithAudio,m=e.disabled,h=e.inputDisabled;return o.a.createElement("div",{className:Object(s.classNames)("JoinScreen",{"JoinScreen--anonym":t})},o.a.createElement(rr,null,o.a.createElement(N.default,{className:""},n)),o.a.createElement("div",{className:"JoinScreen__members"},o.a.createElement(ir,{items:r}),o.a.createElement("div",{className:"JoinScreen__membersLabel"},a)),o.a.createElement("footer",{className:"JoinScreen__footer"},t&&o.a.createElement(da.default,{onChange:i,className:"JoinScreen__input",value:l,placeholder:c,disabled:h,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&d()}}),o.a.createElement(mn.default,{appearance:"primary",onClick:d,disabled:m,type:"submit"},o.a.createElement(sr,{className:"JoinScreen__icon"}),o.a.createElement("span",null,u)),o.a.createElement(mn.default,{appearance:"primary",title:p,"aria-label":p,onClick:f,disabled:m},o.a.createElement(Ln,{className:"JoinScreen__icon"}))))},pr=n("yqpO"),dr=n("S6+Z"),fr=function(e){var t=e.ownerId,n=e.isAnonym,a=e.joinLink,i=e.vkJoinLink,l=e.title,c=e.members,s=e.conversationData,u=e.withPopup,p=e.onBeforeCallStart,d=e.onAfterCallFinish,f=e.onClose,m=e.bridge,h=e.entryPoint,v=e.tabIsMaster,E=e.tabIsIdle,_=e.onError,g=o.a.useContext(D),O=g.getLang,b=g.langNumeric,C=Object(r.useState)(""),y=C[0],S=C[1],I=Object(r.useState)(null),A=I[0],N=I[1],w=Object(r.useState)(!1),P=w[0],L=w[1],T=!1,j=c?c.slice(0,3).map((function(e){return e.photo_100?{src:e.photo_100,alt:e.firstName,key:e.peerId}:{id:e.peerId,text:e.firstName.slice(0,1)}})):[],M=Object(r.useCallback)((function(e){S(e.target.value)}),[]),k=Object(r.useCallback)((function(e){if(n){if(T)return;return T=!0,function(e,t,n,a,r){if(e)return Promise.resolve(e);return((e,t,n)=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_anonym_call_token",join_link:e,user_id:t,name:n}))(n,a,r).then((function(e){var n=e[0];return t(n),Promise.resolve(n)}))}(A,N,i,t,y).then((function(e){return function(e){var t=e.bridge,n=e.inited,a=e.setInited,r=e.data,o=e.onBeforeCallStart,i=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,s=e.langUtils;if(n)return Promise.resolve();var u=r.callsCredentials,p=r.participantLimit,d=r.imHash,f=r.callsUseDirectAudioMix,m=r.callsOkStaging,h=r.callsLogLongpollPush;return t.init({callsCredentials:u,imHash:d,participantLimit:p,callsUseDirectAudioMix:f,callsOkStaging:m,callsLogLongpollPush:h,onBeforeCallStart:o,onAfterCallFinish:i,tabIsMaster:l,tabIsIdle:c,langUtils:s}).then((function(){return a(!0)}))}({bridge:m,inited:P,setInited:L,data:e,onBeforeCallStart:p,onAfterCallFinish:d,tabIsMaster:v,tabIsIdle:E,langUtils:g})})).then((function(){return m.joinCallByLink(0,a,null,e,h)})).catch((function(e){var t="string"==typeof e?e:O("global_unknow_error");_&&_(t)})).finally((function(){T=!1}))}if(f&&f(),!s)throw Error("no peer_id to join");m.joinCallByLink(s.peerId,a,[s,c],e,h)}),[a,f,y,A,P]),x=Object(r.useCallback)((function(){f&&f()}),[f]),U=Object(r.useMemo)((function(){var e=Object(On.clean)(Object($.decodeHTMLEntities)(l)),t=Object(dr.emojiRegex)();return e.replace(t,pr.emojiReplace)}),[l]),G=o.a.createElement(ur,{isAnonym:n,name:y,onChangeName:M,namePlaceholder:O("calls_name_placeholder"),title:U,label:me(c||[],j,(function(e){return e.firstName}),O,b),items:j,joinWithVideoText:O("calls_join_with_video"),joinWithAudioText:O("calls_join_with_audio"),onJoinWithVideo:function(){return k(!0)},onJoinWithAudio:function(){return k(!1)},disabled:n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(y),inputDisabled:!!A});return u?o.a.createElement(R.default,{onClose:x},o.a.createElement(hn.ModalHeader,{appearance:"blue",title:O("calls_invite"),onClose:x}),G):G};var mr,hr=function(e){var t=e.children;return o.a.createElement("div",{className:"ErrorPopupText"},t)},vr=function(e){var t=e.title,n=e.onClose,a=e.actionButtons,r=e.text;return o.a.createElement(Xn.default,{appearance:"blue",title:t,onClose:n,actionButtons:a,className:"CallError"},o.a.createElement(hr,null,r))},Er=function(e){var t=e.title,n=e.text,a=e.onCloseFatal,r=e.handleType,i=e.callId,s=e.bridge,u=Object(l.useDispatch)(),p=o.a.useContext(D).getLang,d=function(){switch(u({type:c.ERROR,isClosed:!0}),r){case c.ErrorHandleType.FATAL:a();break;case c.ErrorHandleType.DECLINE:Object(Lt.declineCall)().catch((function(){}));break;case c.ErrorHandleType.PROCESS:Object(Lt.processPush)(i||"").then((function(){Object(Lt.declineCall)().catch((function(){}))})).catch((function(e){s.debug&&console.error("Delayed by error push process error",e)}))}};return o.a.createElement(vr,{title:o.a.createElement(N.default,null,t||p("calls_oops")),onClose:d,actionButtons:o.a.createElement(mn.default,{onClick:d},p("global_close")),text:o.a.createElement(N.default,null,n||p("global_error"))})},_r=function(e){var t=e.onClose,n=e.actionButtons,a=o.a.useContext(D).getLang;return o.a.createElement(Xn.default,{onClose:t,title:a("calls_exit_menu"),appearance:"blue",actionButtons:n,className:"CallExitModal"},o.a.createElement("div",{className:"CallExitModal__text"},a("calls_sure_leave_call")))},gr=function(e){var t=e.SDK,n=Object(l.useSelector)((function(e){return e})),a=Object(l.useDispatch)(),i=o.a.useContext(D).getLang,s=function(){return F.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:n.callData.callId,peer_id:n.peer,is_group_call:V(n.peer),reason:"none",group_call_users_count:xt(n)})},u=Object(r.useCallback)((function(){a({type:c.TOGGLE_POPUP})}),[]);return o.a.createElement(_r,{onClose:u,actionButtons:[o.a.createElement(mn.default,{onClick:function(){a({type:c.TOGGLE_POPUP}),s(),nr(0,n,a,i)},key:"forceCallFinish",appearance:"secondary"},i("calls_force_call_finish")),o.a.createElement(mn.default,{onClick:function(){return a({type:c.TOGGLE_POPUP}),s(),t.hangup()},key:"leave"},i("calls_leave_call"))]})};!function(e){e.CONTAIN="cn",e.COVER="cv"}(mr||(mr={}));function Or(e,t,n){return e.uiMode===c.UIMode.COLLAPSED?function(e){var t=le(e),n=Rt(e,t);return kt(e).reduce((function(e,t){var a=t.peerId,r=t.mediaSettings;return a===(null==n?void 0:n.peerId)&&(null==r?void 0:r.isVideoEnabled)?e.set(t.peerId,{fit:mr.CONTAIN,width:265,height:200,priority:2,uid:jt(n)}):e.set(t.peerId,{fit:mr.CONTAIN,width:0,height:0,priority:-1,uid:jt(t)}),e}),new Map)}(e):e.isOratorMode?function(e,t,n){var a=e.pinnedParticipant||e.orator||e.me;return kt(e).reduce((function(r,o){var i=o.peerId,l=o.mediaSettings;if(a===i&&(null==l?void 0:l.isVideoEnabled)){var s=e.uiMode===c.UIMode.FULLSCREEN;r.set(o.peerId,{fit:mr.CONTAIN,width:s?t:900,height:s?n:504,priority:3,uid:jt(o)})}else(null==l?void 0:l.isVideoEnabled)&&!1!==e.visibleParticipants[o.peerId]?r.set(o.peerId,{fit:(null==l?void 0:l.isScreenSharingEnabled)?mr.CONTAIN:mr.COVER,width:140,height:140,priority:1,uid:jt(o)}):r.set(o.peerId,{fit:mr.COVER,width:0,height:0,priority:-1,uid:jt(o)});return r}),new Map)}(e,t,n):function(e,t,n){var a=e.uiMode===c.UIMode.FULLSCREEN,r=a?t:900,o=a?n:504,i=kt(e),l=function(e,t,n){switch(n){case 1:return t;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(t/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(t/3);default:return Math.round(e/6)}}(r,o,i.length),s=l<200?1:2;return i.reduce((function(t,n){var a;return(null===(a=n.mediaSettings)||void 0===a?void 0:a.isVideoEnabled)&&!1!==e.visibleParticipants[n.peerId]?t.set(n.peerId,{fit:mr.COVER,width:l,height:l,priority:s,uid:jt(n)}):t.set(n.peerId,{fit:mr.COVER,width:0,height:0,priority:-1,uid:jt(n)}),t}),new Map)}(e,t,n)}var br=function(e,t){var n=Object(r.useState)([0,0]),a=n[0],o=a[0],i=a[1],l=n[1],s=Object(r.useCallback)(Object(Xe.throttle)(Cr,1e3),[]),u=Object(r.useRef)(new Map),p=Object(r.useRef)([]);Object(r.useEffect)((function(){var e=function(){return l([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(r.useEffect)((function(){if(t.mode===c.Mode.CALL){var n=Or(t,o,i),a=function(e,t){var n=[];return t.forEach((function(t,a){var r,o,i=e.get(a);i&&(o=t,(r=i).fit===o.fit&&r.width===o.width&&r.height==r.height&&r.priority===o.priority)||n.push(t)})),n}(u.current,n);a.length>0&&s(e,t,a,u,n,p)}}),[o,i,t.mode,t.visibleParticipants,t.uiMode,t.isOratorMode,t.orator,t.pinnedParticipant])};function Cr(e,t,n,a,r,o){if(t.mode!==c.Mode.CALL)return a.current=new Map,void(o.current=[]);o.current=n,a.current=r,e.updateDisplayLayout(n)}var yr=function(e){var t=e.isIncoming,n=void 0!==t&&t,a=Object(l.useSelector)((function(e){return e})),i=Object(l.useDispatch)(),s=Object(r.useContext)(D).getLang,u=s(n?"calls_reject_title":"calls_hangup_description"),p=s(n?"calls_reject_description":"calls_hangup_description"),d=Object(r.useCallback)((function(){i({type:c.SHOW_CAUTION_BOX,isOpen:!1})}),[]);return o.a.createElement(vr,{title:u,onClose:d,actionButtons:o.a.createElement(o.a.Fragment,null,o.a.createElement(mn.default,{onClick:function(){d(),n?Object(Lt.declineCall)().catch((function(){})):(Object(Lt.hangup)().catch((function(){})),F.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:V(a.peer),reason:"none",group_call_users_count:ie(a).length}))}},s("global_yes")),o.a.createElement(mn.default,{onClick:d},s("global_no"))),text:p})},Sr=n("yAhi");function Ir(){return(Ir=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ar(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function wr(e){var t=e.SDK,n=e.bridge,a=e.onBeforeCallStart,o=e.onAfterCallFinish,i=e.tabIsMaster,s=Object(l.useSelector)(e=>e),u=Object(l.useDispatch)(),p=r.useRef(s),d=r.useCallback(()=>{u({type:c.CHANGE_MODE,mode:c.Mode.READY})},[]),f=Ar(r.useState(null),2),m=f[0],h=f[1];return r.useEffect(()=>{p.current=s},[s]),function(e,t,n,a){void 0===a&&(a=[]);var o=window.document,i=o.documentElement,l=i.requestFullscreen||i.webkitRequestFullscreen;if(l){var c=!i.requestFullscreen,s=c?o.webkitExitFullscreen:o.exitFullscreen,u=c?"webkitfullscreenchange":"fullscreenchange",p=c?"webkitFullscreenElement":"fullscreenElement";Object(r.useEffect)((function(){var e=function(){o.fullscreenElement?t&&t():n&&n()};return o.addEventListener(u,e),function(){return o.removeEventListener(u,e)}}),[]),Object(r.useEffect)((function(){e&&!o[p]?l.call(o.documentElement):!e&&o[p]&&s.call(o)}),a)}}(s.uiMode===c.UIMode.FULLSCREEN&&s.mode===c.Mode.CALL,()=>{window.FastChat&&(h(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0))},()=>{p.current.uiMode===c.UIMode.FULLSCREEN&&u({type:c.CHANGE_UI_MODE,mode:c.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(m),h(null))},[s.uiMode,s.mode]),br(t,s),r.createElement(ea,{SDK:t,mode:s.mode,onReset:()=>u({type:c.CHANGE_MODE,mode:c.Mode.READY})},i()&&r.createElement(fn,{onBeforeCallStart:a,onAfterCallFinish:o}),s.mode===c.Mode.CALL&&s.uiMode!==c.UIMode.COLLAPSED&&r.createElement(rn,{SDK:t}),s.mode===c.Mode.INCOMING&&s.uiMode!==c.UIMode.COLLAPSED&&r.createElement(Y,{SDK:t}),s.mode!==c.Mode.READY&&s.uiMode===c.UIMode.COLLAPSED&&r.createElement(pn,{SDK:t}),s.mode===c.Mode.JOIN&&r.createElement(fr,Ir({},s.join,{bridge:n,withPopup:!0,onClose:d,onError:e=>{u({type:c.ERROR,text:e})}})),s.errorShown&&r.createElement(Er,{title:s.error.title,text:s.error.text,handleType:s.error.handleType,callId:s.error.callId,bridge:n,onCloseFatal:d}),s.cautionShown&&r.createElement(yr,{isIncoming:s.isIncoming}),s.groupCallSetup&&r.createElement(Un,{SDK:t}),s.isManagementOpen&&r.createElement(ar,{SDK:t}),s.popup===c.POPUP_SETTINGS&&r.createElement(Zn,{SDK:t}),s.popup===c.POPUP_EXIT&&r.createElement(gr,{SDK:t}),s.isLoaderVisible&&r.createElement(Sr.default,null))}n("OEbY");var Pr=n("eaP7"),Lr=function(){return(Lr=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Tr={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function jr(e){switch(e){case c.CallStatus.WAITING:return 1;case c.CallStatus.CONNECTING:return 2;case c.CallStatus.CONNECTED:return 3;default:return 0}}var Dr=function(){return Tr},Mr=function(e){var t,n;Tr=Lr(Lr(Lr({},Tr),e),{connectionStep:(t=e.connectionStep,n=Tr.connectionStep,t&&jr(t)&&jr(t)>jr(n)?t:n)})},Rr=function(){Tr={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}},kr=n("MhhX");function xr(){return(xr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ur(e,t,n,a){var r=n.reduce((n,r)=>{switch(r.type){case Pr.INCOMING_CALL:if(!Gr(e,r,a)){n.push(Promise.resolve());break}var o=oe(r),i=(u=r.payload,p=u.caller_info,d=p.first_name+" "+p.last_name,{peerId:+p.user_id,name:d,tab:d,photo:p.photo_400});if(o){var l=function(e){var t=e.chat_info;return{peerId:2e9+t.chat_id,tab:t.title,name:t.title,photo:t.photo_400}}(r.payload);t({type:c.LOAD_PEERS,conversation:l,members:[i],peerId:l.peerId}),l.photo&&n.push(Ct(l.photo));var s=function(e,t,n){var a=Ra(e,t),r=a[0],o=a[1];return ue(Va,fe.bind(null,r,o))(n).then((function(e){var n=e[0],a=e[1];yt([n,a]).catch(console.error),t({type:c.LOAD_PEERS,conversation:n,members:a})}))}(e,t,l.peerId);n.push(s)}else t({type:c.LOAD_PEERS,conversation:i,members:[i],peerId:i.peerId});i.photo&&n.push(Ct(i.photo))}var u,p,d;return n},[]);return Promise.all(r)}function Gr(e,t,n){return function(e){return!!e.payload.call_id}(t)&&e.mode!==c.Mode.INCOMING&&e.mode!==c.Mode.CALL&&n()}function Vr(e){var t=e.onVolumeLevelReached,n=e.needCheckMicEnabled,a=e.vectorLength,r=e.volumeLevelDetection,o=e.callbackFactorStep,i=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,s=function(e){var t=[],n=0;return function(a){if(t.push(a),n+=a,t.length>e){var r=t.shift();n-=r||0}return n/t.length}}(a),u=0,p=!1;return function(e,a){c&&c(arguments);var d=e>r;p!==d&&l&&l(d),p=d,0!==u&&a&&(u=0);var f=s(e);n&&a||e/f>(1+u)/i&&e>r&&(u+=o,t())}}function Hr(e,t){var n=Object.keys(e),a=Object.keys(t);return n.length===a.length&&n.every((function(e){return t[e]}))}function Br(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}var Fr=n("tGJf");function zr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Yr;function Kr(e){Fr.vkLocalStorage.setItem("calls_token",e)}function Jr(){return Fr.vkLocalStorage.getItem("calls_token")}function qr(e,t){var n=Jr();return n?Promise.resolve(n):ue(Ba,fe.bind(null,e,t),pe)().then(e=>zr(e,1)[0])}function Xr(e){Yr=e}function $r(e,t,n,a){var r,o,i,l=Dr(),s=l.startType,u=l.entryPoint,p=l.timeStart,d=l.isGroupCall,f=l.hadVideoEnabled,m=l.isOutgoingCall,h=!e||e===c.HANGUP_TYPE_HUNGUP&&!n,v={type:s&&function(e,t,n){var a;a=e===c.CallType.VIDEO?t?c.CallStatReachedType.GROUP_VIDEO:c.CallStatReachedType.VIDEO:n?t?c.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:c.CallStatReachedType.AUDIO_TO_VIDEO:t?c.CallStatReachedType.GROUP_AUDIO:c.CallStatReachedType.AUDIO;return a}(s,d,f),result:h?c.CallStatResult.SUCCESS:c.CallStatResult.FAIL,failReason:h?null:Qr(e,n),callSource:u,totalDuration:p?Date.now()-p:0};m&&(a&&console.log(v),r=t,i=[(o=v).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],Yr&&Yr({name:"call_stats",value:r,keys:i}))}function Qr(e,t){var n=Dr().isOutgoingCall,a=Dr().connectionStep;switch(!0){case t:return c.CallStatFailReason.CONNECTION_LOST;case e===c.HANGUP_TYPE_CANCELED:return c.CallStatFailReason.LOCAL_DECLINE;case e===c.HANGUP_TYPE_REJECTED:return c.CallStatFailReason.REMOTE_DECLINE;case e===c.HANGUP_TYPE_BUSY:return c.CallStatFailReason.REMOTE_BUSY;case e===c.HANGUP_TYPE_MISSED:return n?c.CallStatFailReason.REMOTE_TIMEOUT:null;case a===c.CallStatus.CONNECTING:return c.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return c.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}var Zr=function(){return(Zr=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},eo=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a};function to(e,t,n,a,r,o,i){var l,s,u,p,d,f,m,h,v=a.dispatch,E=a.getState(),_=E.me,g=c.BAD_CONNECTION_DISABLED_CAMERA_LEVEL,O=!1,b=ue(oo,de.bind(null,ao.bind(null,t,e,a,v))),C=ue(t.joinCallByLink,de.bind(null,ao.bind(null,t,e,a,v))),y={apiKey:n.key,apiEnv:n.is_dev?"VIDEOTEST":"PROD",anonymToken:n.is_anonym?n.token:"",voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},directAudioOutput:o?"AudioElementMix":"AudioElement",allowMissingMic:!0,domain:i?"vk_corp":void 0,onLocalStream:function(t,n){e.debug&&console.warn("onLocalStream",t,n),Zt(v,_,{stream:t,mediaSettings:n}),Mr({hadVideoEnabled:n.isVideoEnabled})},onLocalStreamUpdate:function(t,n){e.debug&&console.warn("onLocalStreamUpdate",t,n);var r=a.getState(),o=a.getState().participants[_].mediaSettings||{};Zt(v,_,{mediaSettings:t}),t.isScreenSharingEnabled!==o.isScreenSharingEnabled&&uo(r,v,t.isScreenSharingEnabled,_),Mr({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:function(t,n){e.debug&&console.warn("onRemoteStream",t.id,n),Zt(v,t.id,{stream:n})},onConversation:function(t){if(e.debug&&console.warn("onConversation",t),!a.getState().callData.ts){var n=Date.now();v({type:c.TIME_START,data:n})}er(E,v,a.getState().peer)},onRemoteMediaSettings:function(t,n){var r,o;e.debug&&console.warn("onRemoteMediaSettings",t.id,n);var i=+t.id,l=a.getState(),c=null===(o=null===(r=l.participants[i])||void 0===r?void 0:r.mediaSettings)||void 0===o?void 0:o.isScreenSharingEnabled;n.isScreenSharingEnabled!==c&&uo(l,v,n.isScreenSharingEnabled,i,!0),Zt(v,i,{mediaSettings:n}),Mr({hadVideoEnabled:n.isVideoEnabled})},onParticipantStatus:function(t,n,r){var o=+t.id,i=a.getState(),l=n;if(e.debug&&console.warn("onParticipantStatus",o,l,r),!i.participants[o]){v({type:c.LOAD_PEERS,members:[{peerId:o,mediaSettings:{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},isAnonym:"ANONYM"===t.type}]});var s="ANONYM"===t.type?[-Math.abs(o)]:[o],u=i.callData.callId||"",p={withConversation:!a.getState().callData.conversation,awaitImages:!0};tr(i,v,u,s,p)}Zt(v,o,{status:l,statusData:r}),Mr({connectionStep:l}),o===i.peer&&l===c.CallStatus.CONNECTED&&F.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:i.callData.callId,peer_id:i.peer,is_group_call:!1})},onUserPermissions:function(t){e.debug&&console.warn("onUserPermissions",t),v({type:c.CALL_STATE,callData:{permissions:t.reduce((function(e,t){return e[t]=!0,e}),{})}})},onPermissionsError:function(n){if(e.debug&&console.warn("onPermissionsError",n),a.getState().mode===c.Mode.CALL){switch(n){case c.MediaError.CAMERA_PERMISSION:case c.MediaError.CAMERA_ACCESS:t.toggleLocalVideo(!1);break;case c.MediaError.MIC_ACCESS:case c.MediaError.MIC_NOT_FOUND:t.toggleLocalAudio(!1);break;case c.MediaError.SCREEN_PERMISSION:case c.MediaError.SCREEN_ACCESS:t.captureScreen(!1)}v({type:c.ERROR,text:W(n,r)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t){e.debug&&console.warn("onRemoteRemoved",t.id),v({type:c.REMOVE_USER,participantId:+t.id})},onCallState:function(t,n,r){e.debug&&console.warn("onCallState",t,n,r);var o=r.id,i=r.direction;o&&a.getState().callData.callId||(v({type:c.CALL_STATE,callData:{callId:o}}),a.getState().peer||tr(E,v,o,[],{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!0}),!V(a.getState().peer||0)||"JOINING"!==i&&"OUTGOING"!==i||F.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:o,peer_id:a.getState().peer||0,is_group_call:!0}))},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(t){var n=t.id;e.debug&&console.warn("onSpeakerChanged",n),v({type:c.SET_ORATOR,orator:+n})},onJoinStatus:function(t,n){e.debug&&console.warn("onJoinStatus",t,n)},onHangup:function(t,n){var r=t.hangup;e.debug&&console.warn("onHangup",r,n);var o=r&&![c.HANGUP_TYPE_CANCELED,c.HANGUP_TYPE_MISSED,c.HANGUP_TYPE_HUNGUP,c.HANGUP_TYPE_REMOVED].includes(r);a.getState().mode===c.Mode.CALL&&o?(v({type:c.HANGUP,data:r}),Object(K.pause)(c.HANGUP_DELAY).finally((function(){v({type:c.CHANGE_MODE,mode:c.Mode.READY})}))):v({type:c.CHANGE_MODE,mode:c.Mode.READY}),e.isInActiveCall=!1,$r(r,n=n||"",function(e){return!!Object.values(e.participants).find(e=>e.status===c.CallStatus.RECONNECT)}(a.getState()),e.debug),Rr()},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),V(a.getState().peer)&&F.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:V(a.getState().peer)})},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(ao(t,e,a,v),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(t){e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(l={onUpdate:function(e){v({type:c.SET_SPEAKERS,data:e})},volumeLevelDetection:c.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},s=l.onUpdate,u=l.volumeLevelDetection,p=l.debugCallback,d={},f=[],m={},h=[],function(e){p&&p(arguments),m=Object.keys(m).reduce((function(e,t){return m[t]-1>0&&(e[t]=m[t]-1),e}),{});var t=e.reduce((function(e,t){var n=t.uid.id;return t.volume>u&&(e[n]=!0,m[n]=3),e}),{});h=Object.keys(m);var n=!1,a={speakers:null,speakersInHeader:null};Hr(d,t)||(a.speakers=t,d=t,n=!0),Br(f,h)||(a.speakersInHeader=h,f=h,n=!0),n&&s(a)}),onLocalVolume:Vr({onVolumeLevelReached:function(){var e=a.getState();v({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.SPEAKING_ON_MUTE}}),F.logEvent({call_event_type:c.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:V(e.peer)})},onVolumeLevelUpdated:function(e){var t,n=null===(t=a.getState().participants[_].mediaSettings)||void 0===t?void 0:t.isAudioEnabled,r=a.getState().speakers,o=Object.assign({},r);e&&n?o[_]=!0:e||delete o[_],o[_]!==r[_]&&v({type:c.SET_SPEAKERS,data:{speakers:o}})},needCheckMicEnabled:!0,volumeLevelDetection:c.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(t,n,a){e.debug&&console.warn("onChatMessage",t,n,a)},onCustomData:function(t,n){e.debug&&console.warn("onCustomData",t,n)},onNetworkStatus:function(n){var r=a.getState();if(e.debug&&console.warn("onNetworkStatus",n),!n){var o=a.getState().participants[_].mediaSettings,i=!!(null==o?void 0:o.isScreenSharingEnabled),l=!!(null==o?void 0:o.isVideoEnabled);O||!l||i||g--,g>0||O||i||!l?v({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.BAD_NETWORK_CONNECTION}}):(O=!0,t.toggleLocalVideo(!1).catch(console.error),v({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA}}),F.logEvent({call_event_type:c.CallActionEventType.VIDEO_DISABLED,session_id:r.callData.callId,peer_id:r.peer,is_group_call:V(r.peer),reason:"lowBandwidth"}),F.logEvent({call_event_type:c.CallActionEventType.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT,session_id:r.callData.callId,peer_id:r.peer,is_group_call:V(r.peer)}))}},onDebugMessage:function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];e.debug&&console.warn.apply(console,eo(["onDebugMessage",t],n))},onRemoteParticipantState:function(t,n){var r,o,i;e.debug&&console.warn("onRemoteParticipantState",t,n);var l=function(e){return e.hand?Zr(Zr({},e),{hand:e.hand===c.SdkHandType.RAISED}):e}(n),s=t.id,u=!!(null===(o=null===(r=a.getState().participants[s])||void 0===r?void 0:r.statusData)||void 0===o?void 0:o.hand),p=!!(null===(i=a.getState().participants[s])||void 0===i?void 0:i.name);Zt(v,s,{statusData:l}),(null==l?void 0:l.hand)&&!u&&p&&v({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.RAISED_HAND,data:s}})}};e.authorized=!1,e.call=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u){return e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(no):(e.isInActiveCall=!0,Promise.resolve().then((function(){return ro(e)})).then((function(){return H(t,l)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return io(a,i,s)})).then((function(e){return Promise.all([yt(e),r(t,a.getState(),l,i)])})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:i}),Mr({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:u,startType:l?c.CallType.VIDEO:c.CallType.AUDIO}),F.logEvent({call_event_type:l?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:i,is_group_call:!1,source:u,group_call_users_count:2}),lo(a,i,s)})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),so(a,t,e,V(i),l,n,o)})))}}(e,t,r,a,b),e.startGroupCall=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u,p){var d=s?s.filter(G.isUserPeer):[];return e.debug&&s&&s.length!==d.length&&console.warn("Some ids cannot get into the call.",s.filter((function(e){return!Object(G.isUserPeer)(e)}))),e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(no):(e.isInActiveCall=!0,Promise.resolve().then((function(){return ro(e)})).then((function(){return H(t,u)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return io(a,i,l)})).then((function(e){return Promise.all([Qa(a.getState(),o,i,e[0]),$a(a.getState(),o)])})).then((function(){return r(t,a.getState(),u,i)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:i}),d&&d.length?o({type:c.GROUP_CALL_SETUP,open:!0,peerId:i,preselectedIds:d}):o({type:c.MANAGEMENT,isOpen:!0}),lo(a,i,l),Mr({timeStart:Date.now(),isOutgoingCall:!0,startType:u?c.CallType.VIDEO:c.CallType.AUDIO,entryPoint:p,isGroupCall:!0}),F.logEvent({call_event_type:u?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:i,is_group_call:!0,source:p,group_call_users_count:1})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),so(a,t,e,V(i),u,n,o)})))}}(e,t,r,a,b),e.startCall=function(e,t,n,a,r){var o=a.dispatch;return function(i,l){if(e.isInActiveCall)return Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(no);e.isInActiveCall=!0;var s={peerId:0,canAddMembers:!0,tab:n("calls_new_call_title"),photo:"/images/call_convo_stub.png"};return Promise.resolve().then((function(){return ro(e)})).then((function(){return H(t,i)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Promise.all([r(t,a.getState(),i),yt([s])])})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.LOAD_PEERS,conversation:s,members:[],peerId:0}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL}),o({type:c.MANAGEMENT,isOpen:!0}),Mr({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:l,startType:i?c.CallType.VIDEO:c.CallType.AUDIO,isGroupCall:!0}),F.logEvent({call_event_type:i?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:0,is_group_call:!0,source:l,group_call_users_count:1})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),so(a,t,e,!0,i,n,o)}))}}(e,t,r,a,b),e.joinCallByLink=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u,p){return void 0===u&&(u=!1),e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(no):(e.isInActiveCall=!0,Promise.resolve().then((function(){return ro(e)})).then((function(){return H(t,u)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Tt(a.getState().me)?r(l,u).then((function(e){var t=e.id;return tr(a.getState(),o,t,[],{withConversation:!0,withCallParticipants:!0})})):io(a,i,s).then((function(e){return Promise.all([yt(e),r(l,u)])}))})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:i}),lo(a,i,s),F.logEvent({call_event_type:c.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:i,is_group_call:!0,source:p,group_call_users_count:ie(a.getState()).length})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),so(a,t,e,V(i),u,n,o)})))}}(e,t,r,a,C),e.showJoinPopup=function(e,t,n){var a=n.dispatch;return function(e,r){var o=n.getState().mode;return o===c.Mode.CALL||o===c.Mode.INCOMING?Promise.reject().catch((function(){a({type:c.ERROR,text:t("calls_already_in_call_error")})})):(a({type:c.SHOW_LOADER,isLoaderVisible:!0}),(e=>Object(Ua.post)(Ga.CONTROLLER,{act:"a_get_call_preview",join_link:e}))(e).then((function(e){var t=e[0];a({type:c.SHOW_LOADER,isLoaderVisible:!1}),a({type:c.JOIN,data:Zr(Zr({},t),{entryPoint:r})})})).catch((function(){a({type:c.SHOW_LOADER,isLoaderVisible:!1}),a({type:c.ERROR,text:t("calls_join_error_text"),handleType:c.ErrorHandleType.FATAL})})))}}(0,r,a);var S=Ra(a.getState(),v),I=S[0],A=S[1],N=n.token?Promise.resolve(n.token):qr(I,A),w=function(n){return Promise.resolve().then((function(){return Tt(a.getState().me)?Promise.resolve():t.authorize(n).then((function(){return Kr(n)})).then((function(){return e.authorized=!0}))})).catch((function(){return Fr.vkLocalStorage.removeItem("calls_token"),qr(I,A).then(w)}))};return N.then((function(e){return t.init(y).then((function(){return w(e)}))}))}function no(e){switch(e){case c.CallErrorType.ALREADY_IN_CALL:console.log("Already in call");break;default:console.log(e)}}function ao(e,t,n,a){var r=Ra(n.getState(),a),o=r[0],i=r[1];return function(e,t){var n=Jr();return n?e.authorize(n).then((function(){return t.authorized=!0})):Promise.reject()}(e,t).catch((function(){return function(e,t,n,a){return ue(Ba,fe.bind(null,n,a),pe)().then((function(n){var a=n[0];return e.authorize(a).then((function(){return Kr(a)})).then((function(){return t.authorized=!0}))}))}(e,t,o,i)})).catch((function(e){return console.log("Could not authorize with token request",e)}))}function ro(e){return e.authorized||Tt(e.id)?Promise.resolve():Promise.reject(c.CLIENT_ERROR_NOT_AUTHORIZED)}function oo(e,t,n,a,r){void 0===a&&(a=0),void 0===r&&(r=[]);var o=function(e,t){return JSON.stringify({is_video:t,chat_id:Object(G.isChatPeer)(e)?e-2e9:void 0,with_join_link:V(e),join_by_link:V(e)})}(a,n);return a?V(a)?e.call(r.filter((function(e){return Object(G.isUserPeer)(e)&&e!==t.getState().me})),n,o,!0):e.call(a.toString(),n,o):e.call(void 0,n,o,!0)}function io(e,t,n){var a=e.dispatch,r=Ra(e.getState(),a),o=r[0],i=r[1];return!!n||t?(n?Promise.resolve(ne(n)):ue(Va,fe.bind(null,o,i))(t).then(ae)).then((function(e){var n=e[0],r=e[1];return a({type:c.LOAD_PEERS,conversation:n,members:r,peerId:t}),e})):Promise.reject("Cannot load data")}function lo(e,t,n){var a=e.dispatch;if(!!!n||!t)return Promise.resolve();var r=Ra(e.getState(),a),o=r[0],i=r[1];return ue(Va,fe.bind(null,o,i))(t).then(yt).then((function(e){var t=ae(e),n=t[0],r=t[1];a({type:c.LOAD_PEERS,conversation:n,members:r})}))}function co(e,t,n){switch(!0){case function(e){var t=e||{},n=t.hangup,a=t.message;return n&&a&&n===c.HANGUP_TYPE_EXTERNAL_API_ERROR}(e):return function(e,t,n){var a=Z(e.split(" : "),2),r=a[0],o=a[1];if("VCHAT_EXTERNAL_API_ERROR"!==r||!o)return n("global_sorry_error");switch(+o){case c.SERVER_ERROR_PRIVACY:return n("calls_privacy_error");case c.SERVER_ERROR_BUSY:return n(t?"calls_chat_busy_error":"calls_busy_error");case c.SERVER_ERROR_FLOOD_CONTROL:return n("calls_flood_error");case c.SERVER_ERROR_UNKNOWN:case c.SERVER_ERROR_INVALID_REQUEST:case c.SERVER_ERROR_INTERNAL:case c.SERVER_ERROR_OLD_RECEIVER_APP:default:return n("calls_start_error")}}(e.message,t,n);case function(e){return"number"==typeof e}(e):case function(e){return!!e}(e):default:return n("global_sorry_error")}}function so(e,t,n,a,r,o,i){var l=co(e,a,o);t.hangup(),n.debug&&e&&console.error(e),i({type:c.ERROR,text:l})}function uo(e,t,n,a,r){0===Object.keys(e.screenSharers).filter((function(t){return e.screenSharers[t]})).length&&n&&(t({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),t({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:a})),t({type:c.SET_SCREEN_SHARER,participantId:a,isScreenSharingEnabled:n}),n&&r&&t({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.SCREEN_SHARING_STARTED,data:a}})}var po=n("Bj12"),fo=n("FbVm"),mo=n("ANjH"),ho=function(){return(ho=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},vo=function(e,t,n){var a,r=n.participantLimit,o=void 0===r?128:r,i=window.vk.id||e.peerId;return{me:i,mode:c.Mode.READY,peer:0,participants:(a={},a[i]=ho(ho({},e),{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1},statusData:{hand:!1}}),a),visibleParticipants:{},callData:{type:null,ts:null},imHash:t,participantLimit:o,popup:null,uiMode:c.UIMode.DEFAULT,orator:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!1,chatMembers:[],preselectedIds:null,friends:[],speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1}};n("T39b");function Eo(){return(Eo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function _o(e,t){switch(t.type){case c.LOAD_PEERS:var n=t.conversation||e.callData.conversation,a=t.members;return Eo({},e,{participants:Eo({},e.participants,{},a.reduce((t,n)=>(n&&n.peerId&&(t[n.peerId]=Eo({},e.participants[n.peerId]||{},{},n)),t),{})),callData:Eo({},e.callData,{conversation:n}),peer:"peerId"in t?t.peerId:e.peer});case c.CHANGE_MODE:var r=t.mode!==c.Mode.READY&&t.data&&t.data.type?t.data.type:null;return t.mode===c.Mode.READY?vo(e.participants[e.me],e.imHash,{participantLimit:e.participantLimit}):Eo({},e,{mode:t.mode,peer:"peerId"in t?t.peerId:e.peer,callData:Eo({},e.callData,{type:r,ts:t.ts||e.callData.ts||null}),hangupType:e.hangupType});case c.HANGUP:return Eo({},e,{hangupType:t.data});case c.TIME_START:return Eo({},e,{callData:Eo({},e.callData,{ts:t.data})});case c.REMOVE_USER:var o=go(e,t.participantId,{status:void 0,statusData:void 0,wasConnected:void 0});if(e.screenSharers[t.participantId]&&delete o.screenSharers[t.participantId],e.orator===t.participantId&&(o.orator=null),e.pinnedParticipant===t.participantId&&(o.pinnedParticipant=null),e.participantsAddedByMe.has(t.participantId)){var i=new Set(e.participantsAddedByMe);i.delete(t.participantId),o.participantsAddedByMe=i}return o;case c.SET_CHAT_INFO:return Eo({},e,{chatMembers:t.data,chatData:t.conversation});case c.GROUP_CALL_SETUP:return Eo({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case c.TOGGLE_POPUP:return Eo({},e,{popup:t.data||null});case c.UPDATE_HASH:return Eo({},e,{imHash:t.hash});case c.CHANGE_UI_MODE:return Eo({},e,{uiMode:t.mode||c.UIMode.DEFAULT});case c.TOGGLE_ORATOR_MODE:return Eo({},e,{isOratorMode:t.isOratorMode});case c.TOGGLE_PARTICIPANTS_ASIDE:return Eo({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case c.SET_ORATOR:return Eo({},e,{orator:t.orator||null});case c.SET_PINNED_PARTICIPANT:return Eo({},e,{pinnedParticipant:t.pinnedParticipant});case c.MANAGEMENT:return Eo({},e,{isManagementOpen:t.isOpen});case c.CALL_STATE:return Eo({},e,{callData:Eo({},e.callData,{},t.callData)});case c.CALL_NOTIFICATION:return Eo({},e,{notification:t.notification});case c.JOIN:return Eo({},e,{mode:c.Mode.JOIN,join:t.data});case c.ERROR:return Eo({},e,{mode:t.handleType===c.ErrorHandleType.FATAL?c.Mode.ERROR:e.mode,errorShown:!t.isClosed,error:{title:t.title,text:t.text,handleType:t.handleType,callId:t.callId}});case c.CHANGE_PARTICIPANT_STATE:var l=e.participants[t.participantId].statusData;return go(e,t.participantId,{statusData:Eo({},l,{},t.data)});case c.SET_SCREEN_SHARER:return Eo({},e,{screenSharers:Eo({},e.screenSharers,{[t.participantId]:t.isScreenSharingEnabled})});case c.SET_FRIENDS:return Eo({},e,{friends:t.data});case c.SET_SPEAKERS:var s=t.data,u=s.speakers,p=s.speakersInHeader;return Eo({},e,{speakers:u||e.speakers,speakersInHeader:p||e.speakersInHeader});case c.UPDATE_PARTICIPANTS_BATCH:return function(e,t){var n,a=$t($t({},e),{participants:$t({},e.participants)});for(var r in t)if(t.hasOwnProperty(r))if(void 0===(null===(n=e.participants[r])||void 0===n?void 0:n.status)&&t[r].status===c.CallStatus.HANGUP)delete a.participants[r];else{var o=e.participants[r]||{},i=t[r],l=i.statusData?$t($t({},o.statusData),i.statusData):o.statusData,s=o.wasConnected||i.status===c.CallStatus.CONNECTED;a.participants[r]=$t($t($t({},e.participants[r]),t[r]),{statusData:l,wasConnected:s})}return a}(e,t.data);case c.SET_UNREAD_COUNT:return Eo({},e,{chatUnreadCount:t.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in t?t.chatUpToMsgId:e.chatUpToMsgId});case c.SHOW_CAUTION_BOX:return Eo({},e,{cautionShown:t.isOpen,isIncoming:t.isIncoming});case c.SHOW_LOADER:return Eo({},e,{isLoaderVisible:t.isLoaderVisible});case c.SET_TOOLTIP:var d=t.tooltips?t.tooltips:Object.keys(e.tooltips).reduce((e,t)=>(e[t]=!1,e),{});return Eo({},e,{tooltips:Eo({},e.tooltips,{},d)});case c.MANUAL_ADD_PARTICIPANTS:return Eo({},e,{participantsAddedByMe:(t.participants||[]).reduce((e,t)=>e.add(t),new Set(e.participantsAddedByMe))});case c.SET_VISIBLE_PARTICIPANTS:return Eo({},e,{visibleParticipants:Eo({},e.visibleParticipants,{},t.data)})}return e}function go(e,t,n){return Eo({},e,{participants:Eo({},e.participants,{[t]:Eo({},e.participants[t],{},n)})})}function Oo(){return(Oo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var bo,Co=n("Db7M"),yo=n("jm8g"),So=function(){return Object(yo.login)("web_token").then((function(e){return e.access_token}))},Io=null,Ao=function(e,t,n){return Io||(Object(yo.setLoginConfig)({appId:6287487,domain:n,onCaptcha:e}),Object(Co.setApiConfig)({appId:6287487,version:"5.133",domain:t,onTokenExpired:So,onCaptcha:e}),Io=Object(yo.login)("web_token").then((function(e){return Object(Co.setApiConfig)({accessToken:e.access_token})})).catch((function(e){console.error("Init api auth failed",e)})))},No=n("EasH"),wo=null,Po=function(e){return new Promise((function(t){var n={imgSrc:e.captcha_img,onSubmit:function(e,n){t({captcha_sid:e,captcha_key:n}),wo&&wo.hide()},onHide:function(){return wo=null}};wo=Object(No.showCaptchaBox)(e.captcha_sid,wo,null,n)}))},Lo=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ao(Po,window.vk.apiConfigDomains.apiDomain,window.vk.apiConfigDomains.loginDomain).then((function(){return e.apply(void 0,t)}))}};window.Calls||(window.Calls=(bo={apiWrapper:Lo}.apiWrapper,bo,{initialized:!1,_initializing:void 0,init(e){var t=e.callsCredentials,n=e.imHash,a=e.participantLimit,o=e.callsUseDirectAudioMix,s=e.callsOkStaging,u=e.callsLogLongpollPush,p=e.tabIsMaster,d=e.tabIsIdle,f=e.onBeforeCallStart,m=e.onAfterCallFinish,h=e.statLogsHandler,v=e.actionStatCollector,E=e.onError,_=e.langUtils;if(this.initialized=!0,!Lt.browser.isBrowserSupported()){var g=()=>{var e=_.getLang("calls_unsupported_browser_error");return E?E({msg:e}):console.error(e),Promise.resolve()};return this.call=g,this.startGroupCall=g,this.startCall=g,this.joinCallByLink=g,void(this.showJoinPopup=g)}this.id=window.vk.id||t.me.peerId;var O=p||(()=>!0),b=d||(()=>!1),C=Object(mo.createStore)(_o,vo(t.me,n,{participantLimit:a}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());return h&&Xr(h),v&&F.setActionStatCollector(v),this._initializing=to(this,Lt,t,C,_.getLang,o,s).then(()=>{!function(e,t,n,a,r,o,i){if(void 0!==window.Notifier){var l=i.dispatch,s=Notifier.getLpInstance();s&&s.onData((function(){for(var s=arguments.length,u=new Array(s),p=0;p<s;p++)u[p]=arguments[p];var d=i.getState();Ur(d,l,u,n).then(()=>{u.forEach(a=>{switch(a.type){case Pr.INCOMING_CALL:if(Gr(d,a,n))t.processPush(a.payload.call_id).then(()=>{var e=JSON.parse(Object(On.decodeHtml)(a.payload.payload)),t=e.is_video?c.CallType.VIDEO:c.CallType.AUDIO;l({type:c.CHANGE_MODE,mode:c.Mode.INCOMING,peerId:re(a.payload),data:xr({},a.payload,{type:t,payload:e})}),Mr({timeStart:Date.now(),startType:t}),F.logEvent({call_event_type:c.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:a.payload.call_id,peer_id:re(a.payload),is_group_call:oe(a),reason:e.is_video?c.CallType.VIDEO:c.CallType.AUDIO})}).catch(t=>{if(e.debug)if("object"==typeof t){var n=t.hangup,a=t.message;console.error("Push process error",n,a)}else console.error("Push process error",t)});else if(a.type===Pr.INCOMING_CALL){var o=t=>{e.debug&&console.warn("Incoming push skipped:",t,a)};switch(!0){case!a.payload.call_id:o("old lib call");break;case!n():o("not master tab");break;case d.mode===c.Mode.CALL||d.mode===c.Mode.INCOMING:o("already in a call")}}r&&Ja(a.payload.call_id,d.imHash);break;case Pr.ADD_MESSAGE:var s=i.getState(),u=Object(G.isChatPeer)(s.peer),p=s.callData.callId;if(s.peer!==a.peerId||a.flags&Pr.FLAG_OUTBOUND||s.me===a.userId||l({type:c.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),u||!Object(kr.isActiveGroupCallMessage)(a))return;var f=a.peerId;if(p===a.kludges.attach1_call_id)return Za(i.getState(),l,f);break;case Pr.READ_INBOUND:null!==a.chatUnreadCount&&i.getState().peer===a.peerId&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:a.unread,chatUpToMsgId:a.upToId});break;case Pr.SET_FLAGS:var m=i.getState();m.peer===a.peerId&&null!==m.chatUpToMsgId&&a.messageId>m.chatUpToMsgId&&!(a.flags&Pr.FLAG_OUTBOUND)&&(a.flags&Pr.FLAG_DELETED||a.flags&Pr.FLAG_SPAM)&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:m.chatUnreadCount?m.chatUnreadCount-1:0});break;case Pr.DELETE_DIALOG:i.getState().peer===a.peerId&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case Pr.EDIT_MESSAGE:case Pr.REPLACE_MESSAGE:var h=i.getState();h.peer===a.peerId&&null!==h.chatUpToMsgId&&a.messageId>h.chatUpToMsgId&&a.kludges.is_expired&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:h.chatUnreadCount?h.chatUnreadCount-1:0});break;case Pr.CONVERSATION_UPDATED:var v=a.peerId,E=a.updateType;if(i.getState().peer!==v)return;if(E!==Pr.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==i.getState().callData.canFinishCall&&i.getState().callData.hasUrlLink||er(i.getState(),l,v)}})}).catch(t=>{e.debug&&console.error("Resource loading error",t),u.forEach(e=>{switch(e.type){case Pr.INCOMING_CALL:if(!Gr(d,e,n)||a())return;l({type:c.ERROR,text:o("calls_incoming_process_error"),handleType:c.ErrorHandleType.PROCESS,callId:e.payload.call_id})}})})}))}}(this,Lt,O,b,u,_.getLang,C),i.render(r.createElement(l.Provider,{store:C},r.createElement(D.Provider,{value:_},r.createElement(wr,{bridge:this,SDK:Lt,tabIsMaster:O,onBeforeCallStart:f,onAfterCallFinish:m}))),function(e){var t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}("calls"))}),this._initializing.catch(e=>{console.error("Could not init calls",e.error,e)})},showJoinScreen(e,t,n,a,o){var l=e=>{o?o({msg:e}):console.error(e)};if(!Lt.browser.isBrowserSupported())return l(a.getLang("calls_unsupported_browser_error"));Xr(po.saveStatlogEvents);var c=new fo.ActionStatCollector(new fo.ProductionStatCollector);F.setActionStatCollector(c);var s=document.querySelector(t);i.render(r.createElement(D.Provider,{value:a},r.createElement(fr,Oo({},e,{withPopup:!1,bridge:this,entryPoint:n,onError:l}))),s)},debug:!1,setDebug(e){this.debug=e,Lt.debug(e)}}));try{window.stManager.done(window.jsc("web/calls.js"))}catch(e){}},Db7M:function(e,t,n){"use strict";n.r(t),n.d(t,"api",(function(){return i})),n.d(t,"setApiConfig",(function(){return o})),n.d(t,"upload",(function(){return l}));var a=n("6Rqf"),r={domain:"api.vk.com"};function o(e){e=Object.assign({},r,e),r=e}function i(e,t,n){var l=r;n&&(l=Object.assign({},r,n));var c,s,u=l.domain,p=Object(a.makeParams)((s={v:(c=l).version||"5.123"},c.appId&&(s.client_id=c.appId),s)),d=function(e){return{access_token:e.accessToken}}(l),f="https://"+u+"/method/"+e+"?"+p,m=Object.assign({},t,d);return Object(a.corsRequest)(f,m).then((function(a){var r;if(a.response)return a.response;var c=a.error;if(!c)return Promise.reject({type:"api_error",error:{error_code:0,error_msg:"Unknown"}});if(l.onCaptcha&&14===c.error_code){var s=c,u=s.captcha_sid,p=s.captcha_img;return l.onCaptcha({captcha_sid:u,captcha_img:p}).then((function(a){var r=Object.assign({},t,a);return i(e,r,n)}))}return!l.onTokenExpired||n&&n.accessToken||5!==c.error_code||!(null===(r=c.error_msg)||void 0===r?void 0:r.includes("access_token has expired"))?Promise.reject({type:"api_error",error:a.error}):l.onTokenExpired().then((function(a){return o({accessToken:a}),i(e,t,n)}))}),(function(e){return Promise.reject({type:"network_error",error:e})}))}function l(e,t){return fetch(e,{method:"POST",body:t,mode:"cors"}).then((function(e){return e.json()}))}},UlUB:function(e,t,n){"use strict";function a(e,t){var n,a,r=!1;return function o(){if(r)return n=arguments,void(a=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,n&&(o.apply(a,n),n=a=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return a}))},jm8g:function(e,t,n){"use strict";n.r(t),n.d(t,"login",(function(){return i})),n.d(t,"setLoginConfig",(function(){return o}));var a=n("6Rqf"),r={domain:"login.vk.com"};function o(e){e=Object.assign({},r,e),r=e}function i(e,t,n){var o=r;n&&(o=Object.assign({},r,n));var l,c=o.domain,s=o.onCaptcha,u="https://"+c+"/?act="+e,p={version:(l=o).version||"1",app_id:l.appId},d=Object.assign({},t,p);return Object(a.corsRequest)(u,d).then((function(a){if("error"===a.type)return Promise.reject({type:"login_error",error:a.error_info});if("captcha"===a.type){if(!s)return Promise.reject({type:"login_error",error:"captcha"});var r=a.captcha_sid,o=a.captcha_img;return s({captcha_sid:r,captcha_img:o}).then((function(a){var r=Object.assign({},t,a);return i(e,r,n)}))}return a.data}),(function(e){return{type:"network_error",error:e}}))}},yLpj:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}});